/**
 * Modules in this bundle
 * @license
 *
 * atlas-js:
 *   license: MIT License
 *   homepage: http://horicdesign.com
 *   version: 0.7.11
 *
 * This header is generated by licensify (https://github.com/twada/licensify)
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Atlas=t()}}(function(){return function(){function t(e,i,h){function s(n,o){if(!i[n]){if(!e[n]){var a="function"==typeof require&&require;if(!o&&a)return a(n,!0);if(r)return r(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[n]={exports:{}};e[n][0].call(c.exports,function(t){return s(e[n][1][t]||t)},c,c.exports,t,e,i,h)}return i[n].exports}for(var r="function"==typeof require&&require,n=0;n<h.length;n++)s(h[n]);return s}return t}()({1:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=[],r=[],n=[],o=0,a=function(){var t=navigator.userAgent;return t.indexOf("iPhone")>0&&-1==t.indexOf("iPad")||t.indexOf("iPod")>0||t.indexOf("Android")>0}(),l=function(t){var e=window.matchMedia("(orientation: portrait)");return e.matches?"portrait":"landscape"}(),c=function(t,e){var i=e.which;switch(i){case 13:t.enter=!0;break;case 16:t.shift=!0;break;case 32:t.space=!0;break;case 39:t.right=!0;break;case 37:t.left=!0;break;case 38:t.up=!0;break;case 40:t.down=!0;break;case 8:t.backspace=!0}e.metaKey&&(t.command=!0);for(var h=0;h<26;h++)if(h+65==i){var s=String.fromCharCode(h+97);t[s]=!0;break}},u=function(t){t.enter=!1,t.command=!1,t.shift=!1,t.space=!1,t.right=!1,t.left=!1,t.up=!1,t.down=!1,t.backspace=!1;for(var e=0;e<26;e++)t[String.fromCharCode(e+97)]=!1},d=function(){var t={};return u(t),t}(),f=function t(){for(var e in t)window[e]=t[e]};f.createClass=function(t,e){var i=function(){this.initialize.apply(this,arguments)};"function"==typeof t&&"object"==(void 0===e?"undefined":h(e))?(i.prototype=Object.create(t.prototype),i.prototype.inherit=function(){this.initialize=this.superClass.prototype.initialize,this.superClass=this.superClass.prototype.superClass,this.initialize&&this.initialize.apply(this,arguments)}):"object"==(void 0===t?"undefined":h(t))&&void 0==e&&(e=t);for(var s in e)i.prototype[s]=e[s];return i.prototype.superClass=t,i},f.extendClass=function(t,e){for(var i in e)(!e.safetyExtend||e.safetyExtend&&!t.prototype[i])&&(t.prototype[i]=e[i])},f.extendClass(Array,{safetyExtend:!0,forEach:function(t){for(var e=0,i=this.length;e<i;e++)t(this[e])},reduce:function(t){for(var e=0,i=0,h=this.length;i<h;i++)e=t(e,this[i]);return e},reduceRight:function(t){for(var e=0,i=this.length-1;i>=0;i--)e=t(e,this[i]);return e},map:function(t){for(var e=0,i=this.length;e<i;e++)this[e]=t(this[e]);return this},max:function(t){for(var e=null,i=0,h=this.length;i<h;i++){var s=t(this[i]);(null===e||e<s)&&(e=s)}return e},min:function(t){for(var e=null,i=0,h=this.length;i<h;i++){var s=t(this[i]);(null===e||e>s)&&(e=s)}return e},clone:function(){if(this[0].constructor==Array){var t,e;for(t=new Array(this.length),e=0;e<t.length;e++)t[e]=this[e].clone();return t}return Array.apply(null,this)}}),f.main=function(t){f._main=t},window.addEventListener("load",function(){f._main&&f._main()});var v=function(t,e,i){var h=t.mover,s=h[h.length-1],r={};return s&&s.and&&(r=s),r.time=0,i&&(r.frame=i),r.loop=!1,r.and=!1,r[e]=!0,r};f.Util=f.createClass({isMobile:a,orientation:l,initialize:function(){this.eventListener={},this.mover=[],this.rot=0,this.moverIndex=0,this.visible=!0,this.eventEnable=!0,this.drawMode="source-over";var t=this.eventListener;t.touchStart=!1,t.touchMove=!1,t.touchEnd=!1,t.keyUp=!1,t.keyDown=!1,t.multiTouchStart=!1,t.multiTouchMove=!1,t.multiTouchEnd=!1,t.orientationChange=!1},tween:function(){var t=this.mover,e=t.length;if(this.moverIndex<e){var i=t[this.moverIndex];i.animate&&this._animate(i),i.moveTo&&this._moveTo(i),i.moveBy&&this._moveBy(i),i.rotateBy&&this._rotateBy(i),i.scaleBy&&this._scaleBy(i),i.then&&this._then(i),i.time++,i.time>=i.frame&&++this.moverIndex==e&&(i.loop?this._refresh():this.stop())}},isQueEmpty:function(){return!this.mover.length},_refresh:function(){this.moverIndex=0;for(var t=this.mover,e=0,i=t.length;e<i;e++){var h=t[e];h.time&&(h.time=0)}},moveTo:function(t,e,i){var h=v(this,"moveTo",i);return h.toX=t,h.toY=e,this.mover.push(h),this},_moveTo:function(t){0===t.time&&(t.diffX=t.toX-this.x,t.diffY=t.toY-this.y),this.x=t.toX-t.diffX*(1-t.time/t.frame),this.y=t.toY-t.diffY*(1-t.time/t.frame)},moveBy:function(t,e,i){var h=v(this,"moveBy",i);return h.diffX=t,h.diffY=e,this.mover.push(h),this},_moveBy:function(t){0===t.time&&(t.toX=this.x+t.diffX,t.toY=this.y+t.diffY),this.x=t.toX-t.diffX*(1-t.time/t.frame),this.y=t.toY-t.diffY*(1-t.time/t.frame)},delay:function(t){var e=v(this,"delay",t);return this.mover.push(e),this},and:function(){var t=this.mover,e=t[t.length-1];return e&&(e.and=!0),this},stop:function(){return this.mover=[],this.moverIndex=0,this},loop:function(){return this.mover[this.mover.length-1].loop=!0,this},rotateBy:function(t,e){var i=v(this,"rotateBy",e);return this.mover.push(i),i.diffAngle=t,this},_rotateBy:function(t){0===t.time&&(t.toAngle=this.rot+t.diffAngle),this.rot=t.toAngle-t.diffAngle*(1-t.time/t.frame)},then:function(t,e){var i=v(this,"then",e);return i.exec=t,this.mover.push(i),this},_then:function(t){t.exec.call(this)},scaleBy:function(t,e,i){var h=v(this,"scaleBy",i);return h.scaleX=t,h.scaleY=e,this.mover.push(h),this},setPosition:function(t,e){return this.x=t,this.y=e,this},saveData:function(t){var e={};for(var i in this)"function"!=typeof this[i]&&(e[i]=this[i]);localStorage.setItem(t,JSON.stringify(e))},getData:function(t){var e=JSON.parse(localStorage.getItem(t));for(var i in e)this[i]=e[i]},getTouchPosition:function(t,e){e&&t.touches[e]||(e=0);var i=this.field,h=parseInt(i.width)/parseInt(i.style.width),s=parseInt(i.height)/parseInt(i.style.height),r={},n=i.getBoundingClientRect(),o=parseInt(n.left),l=parseInt(n.top);isNaN(o)&&(o=0),isNaN(l)&&(l=0);var c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop;return t?!a||a&&t.touches[e]?(r.x=(a?t.touches[e].pageX:t.pageX)-o-c,r.y=(a?t.touches[e].pageY:t.pageY)-l-u):(r.x=-1,r.y=-1):(r.x=event.x-o,r.y=event.y-l),r.x=parseInt(r.x*h),r.y=parseInt(r.y*s),r},getMultiTouchPosition:function(t){for(var e=t.touches.length,i=[],h=0;h<e;h++)i[h]=this.getTouchPosition(t,h);return i},handleEvent:function(t){if(this.eventEnable){t.preventDefault();var e=this.getTouchPosition(t);t.touches?e.touchCount=t.touches.length:e.touchCount=1,e.event=t;switch(t.type){case"touchstart":this.multiTouchStart&&t.touches.length>1?this.multiTouchStart(this.getMultiTouchPosition(t)):this.touchStart&&this.touchStart(e);break;case"mousedown":this.touchStart&&this.touchStart(e);break;case"touchmove":this.multiTouchMove&&t.touches.length>1?this.multiTouchMove(this.getMultiTouchPosition(t)):this.touchMove&&this.touchMove(e);break;case"mousemove":this.touchMove&&this.touchMove(e);break;case"touchend":this.multiTouchEnd&&t.touches.length>1?this.multiTouchEnd(this.getMultiTouchPosition(t)):this.touchEnd&&this.touchEnd(e);break;case"mouseup":this.touchEnd&&this.touchEnd();break;case"keydown":this.keyDown&&this.keyDown(d);break;case"keyup":this.keyUp&&this.keyUp()}}},useEvent:function(){var t=this.field,e=this.eventListener;this.touchStart&&!1===e.touchStart&&(a?t.addEventListener("touchstart",this,!1):t.addEventListener("mousedown",this,!1),e.touchStart=!0),this.touchMove&&!1===e.touchMove&&(a?t.addEventListener("touchmove",this,!1):t.addEventListener("mousemove",this,!1),e.touchMove=!0),this.touchEnd&&!1===e.touchEnd&&(a?t.addEventListener("touchend",this,!1):t.addEventListener("mouseup",this,!1),e.touchEnd=!0),this.multiTouchStart&&!1===e.multiTouchStart&&(e.touchStart||(a?t.addEventListener("touchstart",this,!1):t.addEventListener("mousedown",this,!1)),e.touchStart=!0),this.multiTouchMove&&!1===e.multiTouchMove&&(e.touchMove||(a?t.addEventListener("touchmove",this,!1):t.addEventListener("mousemove",this,!1)),e.touchMove=!0),this.multiTouchEnd&&!1===e.multiTouchEnd&&(e.touchEnd||(a?t.addEventListener("touchend",this,!1):t.addEventListener("mouseup",this,!1)),e.touchEnd=!0),this.keyUp&&!1===e.keyUp&&(t.addEventListener("keyup",this,!1),e.keyUp=!0),this.keyDown&&!1===e.keyDown&&(t.addEventListener("keydown",this,!1),e.keyDown=!0)},remove:function(){this._remove=!0},leave:function(){this._leave=!0},getRand:function(t,e){return~~(Math.random()*(e-t+1))+t},getRandText:function(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",h=i.length,s=0;s<t;s++)e+=i.charAt(Math.floor(this.getRand(0,h)));return e},rgbToHex:function(t,e,i){return"#"+(16777216+(i|e<<8|t<<16)).toString(16).slice(1)},hexToRgb:function(t,e){(void 0===t?"undefined":h(t))==Number&&(e=t,t=null);var i=t||this.color,s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return e?s?"rgba("+parseInt(s[1],16)+","+parseInt(s[2],16)+","+parseInt(s[3],16)+","+e+")":null:s?"rgb("+parseInt(s[1],16)+","+parseInt(s[2],16)+","+parseInt(s[3],16)+")":null},hsvToHex:function(t,e,i){var h,s,r,n,o,a,l,c;switch(s=Math.floor(t/60)%6,h=t/60-Math.floor(t/60),r=Math.round(i*(1-e/255)),n=Math.round(i*(1-e/255*h)),o=Math.round(i*(1-e/255*(1-h))),s){case 0:a=i,l=o,c=r;break;case 1:a=n,l=i,c=r;break;case 2:a=r,l=i,c=o;break;case 3:a=r,l=n,c=i;break;case 4:a=o,l=r,c=i;break;case 5:a=i,l=r,c=n}return a=a<=15?"0"+a.toString(16):a.toString(16),l=l<=15?"0"+l.toString(16):l.toString(16),c=c<=15?"0"+c.toString(16):c.toString(16),"#"+a+l+c},rgbToHsv:function(t,e,i){var h,s,r,n,o,a,t=t/255,e=e/255,i=i/255;a=Math.max(t,e,i);var l=a-Math.min(t,e,i);return 0==l?n=o=0:(o=l/a,h=(a-t)/6/l+.5,s=(a-e)/6/l+.5,r=(a-i)/6/l+.5,t===a?n=r-s:e===a?n=1/3+h-r:i===a&&(n=2/3+s-h),n<0?n+=1:n>1&&(n-=1)),"hsv("+Math.round(360*n)+","+Math.round(100*o)+","+Math.round(100*a)+")"},hexToHsv:function(t){this.hexToRgb(t)},getObjFromRgb:function(t){var e=/rgb\((.*?),(.*?),(.*?)\)/.exec(t);return{r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])}},getObjFromHsv:function(t){var e=/hsv\((.*?),(.*?),(.*?)\)/.exec(t);return{h:parseInt(e[1]),s:parseInt(e[2]),v:parseInt(e[3])}},getSound:function(t){for(var e=0,i=r.length;e<i;e++)t==r[e].name&&(this.sound=new Audio(r[e].src))},soundClonePlay:function(){var t=this.sound;t&&new Audio(t.src).play()},soundLoopPlay:function(){var t=this.sound;t&&(t.loop||t.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),t.loop=!0,t.play())},soundReplay:function(){var t=this.sound;t&&(t.load(),t.play())},soundStop:function(){var t=this.sound;t.paused?t.load():(t.pause(),t.currentTime=0)},soundPlay:function(){var t=this.sound;t&&t.play()},soundPause:function(){var t=this.sound;t&&t.pause()},soundGetCount:function(){var t=this.sound;if(t)return t.currentTime},soundSetCount:function(t){var e=this.sound;e&&(e.currentTime=t)},soundGetVolume:function(){var t=this.sound;if(t)return t.volume},soundSetVolume:function(t){var e=this.sound;e&&(e.volume=t)},soundGetAlltime:function(){var t=this.sound;if(t)return t.duration},soundIsPlaying:function(){var t=this.sound;if(t)return!t.paused},getExtention:function(t){var e;if(!t)return e;var i=t.split("."),h=i.length;return 0===h?e:e=i[h-1]}}),f.App=f.createClass(f.Util,{initialize:function(t){this.inherit(),this._basicConstructor="App";var e=document.createElement("style");e.media="screen",e.type="text/css",document.getElementsByTagName("head")[0].appendChild(e);var i;if(t)i=document.getElementById(t);else{i=document.createElement("canvas");document.getElementsByTagName("body").item(0).appendChild(i)}i.width=320,i.height=480,i.style.top="0px",i.style.left="0px",i.tabIndex="1",document.body.style.margin="0em";navigator.userAgent;a?(i.style.width=window.innerWidth+"px",i.style.height=window.innerHeight+"px",i.addEventListener("touchstart",function(){-1!=this.tabIndex&&this.focus()})):(i.style.width="480px",i.style.height="620px",i.addEventListener("mousedown",function(){-1!=this.tabIndex&&this.focus()}),i.addEventListener("keyup",function(){u(d)},!1),i.addEventListener("keydown",function(t){c(d,t)})),this._css=e,this.field=i,this.ctx=i.getContext("2d"),this.fps=30,this.scene=new f.Scene,this.scene.ctx=this.ctx,this.scene.field=this.field,this.scene.parent=this},clearLockMode:function(){this.field.tabIndex="-1"},setLockMode:function(){this.field.tabIndex="1"},getCanvasURL:function(){return this.field.toDataURL()},getCanvasImage:function(){var t=this.field.toDataURL();window.open(t,"_blank")},getChild:function(t){return this.scene.getChild(t)},getChildren:function(t){return this.scene.getChildren(t)},colorToAlpha:function(t,e){for(var i,h=0,r=s.length;h<r;h++)s[h].name==t&&(i=s[h],i.hex=e,i.index=h);i.addEventListener("load",function(){var t=document.createElement("canvas"),e=t.getContext("2d"),i=this.width,h=this.height,r=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,n=this.hex.replace(r,function(t,e,i,h){return e+e+i+i+h+h}),o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n),a=o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null;e.drawImage(this,0,0);for(var l=e.getImageData(0,0,i,h),c=l.data,u=0;u<h;u++)for(var d=0;d<i;d++){var f=u*(4*i)+4*d;c[f]==a.r&&c[f+1]==a.g&&c[f+2]==a.b&&(c[f+3]=0)}e.putImageData(l,0,0);var v=new Image;v.src=t.toDataURL(),s[this.index]=v})},addChild:function(t){t.ctx=this.ctx,t.field=this.field,this.scene.addChild(t)},addChildren:function(){for(var t=0,e=arguments.length;t<e;t++)this.addChild(arguments[t])},centerize:function(){var t=this.field.style;t.marginTop=-parseInt(t.height)/2+"px",t.marginLeft=-parseInt(t.width)/2+"px",t.top="50%",t.left="50%",t.position="absolute"},fitWindow:function(){this.setSize(window.innerWidth,window.innerHeight);var t=this;window.onresize=function(){t.setSize(window.innerWidth,window.innerHeight)}},setQuality:function(t,e){var i=this.field;i.width=t,i.height=e},setSize:function(t,e){var i=this.field.style;i.width=t+"px",i.height=e+"px"},getSize:function(){var t={};return t.width=parseInt(this.field.style.width),t.height=parseInt(this.field.style.height),t},getQuality:function(){var t={};return t.width=parseInt(this.field.width),t.height=parseInt(this.field.height),t},loadingScene:function(t){this.preScene=t,this.preScene.parent=this},_preLoadEnterFrame:function(){var t=this.field;if(this.useEvent(),this.ctx.clearRect(0,0,t.width,t.height),o>0)this.preScene&&this.preScene._enterFrame();else{this.onLoad&&this.onLoad();for(var e=this.scene.children,i=0,h=e.length;i<h;i++){var s=e[i];s._onLoad&&s._onLoad(),s.onLoad&&s.onLoad()}clearInterval(this.preLoadInterval);var r=this;setInterval(function(){r._enterFrame()},1e3/this.fps)}},_enterFrame:function(){var t=this.field;this.ctx.clearRect(0,0,t.width,t.height),this.useEvent(),this.enterFrame&&this.enterFrame(),this.scene._enterFrame()},pushScene:function(t){for(var e=this.ctx,i=this.field,h=this.scene.children,s=0,r=h.length;s<r;s++){var n=h[s];n.eventEnable=!1,n.onSceneremoved&&n.onSceneRemoved()}for(h=t.children,s=0,r=h.length;s<r;s++){var o=h[s];o.ctx=e,o.field=i,o.eventEnable=!0,o.onScenePushed&&o.onScenePushed()}t.parent=this,t.ctx=e,t.field=i;var a=this.field.style;a.background=null,a.backgroundColor="white",t.color&&this.setColor(t.color),t.image&&this.setImage(t.image),this.scene=t},setColor:function(t){var e=this.field.style;e.background=null,e.backgroundColor=t},setImage:function(t){var e=this.field.style;e.background="url("+t+") no-repeat center",e.backgroundSize="cover"},start:function(){var t=this.field,e=this;this.ctx.clearRect(0,0,t.width,t.height),this.preLoadInterval=setInterval(function(){e._preLoadEnterFrame()},1e3/this.fps)},load:function(){for(var t=function(){o--,console.log(this.src+" is loaded")},e=function(){o--,this.style.display="none",this.loaded=!0,console.log(this.data+" is loaded")},i=function(){o--,this.loaded=!0,console.log(this.src+" is loaded")},h=0,a=arguments.length;h<a;h++){var l=arguments[h],c=l,u=l;if(l instanceof Array)var c=l[0],u=l[1];if(c.match("data:image/png"))var d="png";else var d=this.getExtention(c);if("wav"==d||"mp3"==d||"ogg"==d){var l=new Audio(c);l.name=u,o++,l.addEventListener("canplaythrough",t),r.push(l)}else if("TTF"==d||"ttf"==d){var f=this._css,v=document.createTextNode("@font-face{font-family:'"+u+"';src: url('"+c+"') format('truetype');}");f.styleSheet?f.styleSheet.cssText=v:f.appendChild(v)}else if("svg"==d){var l=document.createElement("object");l.addEventListener("load",e),l.data=c,l.name=u,document.body.appendChild(l),o++,n.push(l)}else if("png"==d||"gif"==d||"jpeg"==d||"jpg"==d){var l=new Image;l.addEventListener("load",i),l.src=c,l.name=u,o++,s.push(l)}}}}),f.Thing=f.createClass(f.Util,{initialize:function(t,e){this.inherit(),this.x=0,this.y=0,this._remove=!1,this.width=t,this.height=e,this.collisionShape="box",this.prepared=!1,this.alpha=1},_scaleBy:function(t){0===t.time&&(t.toWidth=this.width*t.scaleX,t.toHeight=this.height*t.scaleY,t.diffWidth=t.toWidth-this.width,t.diffHeight=t.toHeight-this.height),this.width=t.toWidth-t.diffWidth*(1-t.time/t.frame),this.height=t.toHeight-t.diffHeight*(1-t.time/t.frame)},intersect:function(t,e){var i=this._x||this.x,h=this._y||this.y,s=this._width||this.width,r=this._height||this.height,n=this._rot||this.rot;if("box"==this.collisionShape){var o=t-(i+s/2),a=e-(h+r/2),l=Math.sin(-n),c=Math.cos(-n),u=Math.abs(o*c-a*l),d=Math.abs(o*l+a*c);return u<s/2&&d<r/2}if("circle"==this.collisionShape){var f=s/2,o=t-(i+f),a=e-(h+f);return Math.sqrt(o*o+a*a)<f}return!1},hitTest:function(t){var e=this._x||this.x,i=this._y||this.y,h=this._width||this.width,s=this._height||this.height,r=e+h/2,n=i+s/2,o=t._x||t.x,a=t._y||t.y,l=t._width||t.width,c=t._height||t.height,u=t._rot||t.rot;if("box"!=this.collisionShape)return"circle"==this.collisionShape&&this.within(t,h/2);if("circle"==t.collisionShape)return t.within(this,l/2);if(0!==u&&u!=Math.PI&&"box"==t.collisionShape){var d=o+l/2,f=a+c/2,v=-u;r=Math.cos(v)*(r-d)-Math.sin(v)*(n-f)+d,n=Math.sin(v)*(r-d)+Math.cos(v)*(n-f)+f,e=r-h/2,i=n-s/2}return e<o+l&&o<e+h&&i<a+c&&a<i+s},within:function(t,e){var i=this._x||this.x,h=this._y||this.y,s=this._width||this.width,r=this._height||this.height,n=(this._rot||this.rot,t._x||t.x),o=t._y||t.y,a=t._width||t.width,l=t._height||t.height,c=t._rot||t.rot;if("box"==this.collisionShape)var u=i+s/2,d=h+r/2;else{if("circle"!=this.collisionShape)return!1;var f=s/2,u=i+f,d=h+f}if("box"==t.collisionShape){var v,p,g=n+a/2,m=o+l/2,y=-c,x=Math.cos(y)*(u-g)-Math.sin(y)*(d-m)+g,b=Math.sin(y)*(u-g)+Math.cos(y)*(d-m)+m;v=x<n?n:x>n+a?n+a:x,p=b<o?o:b>o+l?o+l:b;var w=Math.abs(x-v),_=Math.abs(b-p)}else{if("circle"!=t.collisionShape)return!1;var C=a/2,v=n+C,p=o+C,w=Math.abs(u-v),_=Math.abs(d-p);e+=C}return Math.sqrt(w*w+_*_)<e},scale:function(t,e){return this.width?(this.width*=t,this.height*=e):(this._scaleX=t,this._scaleY=e),this},setSize:function(t,e){this.width=t,this.height=e}}),f.Shape=f.createClass(f.Thing,{initialize:function(t,e,i){this.inherit(0,0),this.obj=-1,this.svgid=-1,this._basicConstructor="Shape",this.color=e||"original",this.strokeColor=i||"original",this.colorStops=[],"svg"!=this.getExtention(t)?this.svgid=t:this.setImage(t),this.closeMode=!0,this.strokeMode=!0},setSpriteSize:function(t,e){this.spriteWidth=t,this.spriteHeight=e},setImage:function(t){for(var e=0,i=n.length;e<i;e++)t==n[e].name&&(this.obj=e)},getImage:function(){return n[this.obj]},getImageName:function(){return n[this.obj].data},parsePolygon:function(t){for(var e=t.split(" "),i=[],h=0,s=e.length-1;h<s;h++){var r=e[h].split(","),n=Number(r[0]),o=Number(r[1]),a={method:"lineTo",x:n,y:o};i.push(a)}return i},parsePath:function(t){var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},i=/([astvzqmhlc])([^astvzqmhlc]*)/gi,h=[];return t.replace(i,function(t,i,s){var r=i.toLowerCase();for(s=s.match(/-?[.0-9]+(?:e[-+]?\d+)?/gi),s=s?s.map(Number):[],"m"==r&&s.length>2&&(h.push([i].concat(s.splice(0,2))),r="l",i="m"==i?"l":"L");;){if(s.length==e[r]){if(s.unshift(i),"q"==s[0])var n={method:"quadraticCurveBy",cpx:s[1],cpy:s[2],x:s[3],y:s[4]};else if("Q"==s[0])var n={method:"quadraticCurveTo",cpx:s[1],cpy:s[2],x:s[3],y:s[4]};else if("l"==s[0])var n={method:"lineBy",x:s[1],y:s[2]};else if("L"==s[0])var n={method:"lineTo",x:s[1],y:s[2]};else if("m"==s[0])var n={method:"moveBy",x:s[1],y:s[2]};else if("M"==s[0])var n={method:"moveTo",x:s[1],y:s[2]};else if("c"==s[0])var n={method:"bezierCurveBy",cpx1:s[1],cpy1:s[2],cpx2:s[3],cpy2:s[4],x:s[5],y:s[6]};else if("C"==s[0])var n={method:"bezierCurveTo",cpx1:s[1],cpy1:s[2],cpx2:s[3],cpy2:s[4],x:s[5],y:s[6]};else if("h"==s[0])var n={method:"horizontalBy",x:s[1]};else if("H"==s[0])var n={method:"horizontalTo",x:s[1]};else if("v"==s[0])var n={method:"verticalBy",y:s[1]};else if("V"==s[0])var n={method:"verticalTo",y:s[1]};else if("s"==s[0])var n={method:"bezierCurveShortBy",cpx2:s[1],cpy2:s[2],x:s[3],y:s[4]};else if("S"==s[0])var n={method:"bezierCurveShortTo",cpx2:s[1],cpy2:s[2],x:s[3],y:s[4]};else if("t"==s[0])var n={method:"quadraticCurveShortBy",x:s[1],y:s[2]};else if("T"==s[0])var n={method:"quadraticCurveShortTo",x:s[1],y:s[2]};else var n={};return h.push(n)}h.push([i].concat(s.splice(0,e[r])))}}),h},isLoaded:function(){var t=this.getImage();return!t||!(!t.loaded||!this.ctx)},setLinearGradient:function(t,e,i,h){this.ctx;this.gradientStyle={x1:t,y1:e,x2:i,y2:h},this.gradientType=1},setRadialGradient:function(t,e,i,h,s,r){this.ctx;h||(h=t,s=e,r=r),this.gradientStyle={x1:t,y1:e,r1:i,x2:h,y2:s,r2:r},this.gradientType=2},_addColorStops:function(t){for(var e=this.color,i=0,h=t.length;i<h;i++){var s=t[i],r=s.color;e.addColorStop(s.offset,r)}this.color=e},setColorStops:function(t){this.colorStops=t;var e=this.gradientStyle;1==this.gradientType?this.color=this.ctx.createLinearGradient(e.x1,e.y1,e.x2,e.y2):2==this.gradientType&&(this.color=this.ctx.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2)),this._addColorStops(t)},addColorStops:function(t){for(var e=0,i=t.length;e<i;e++)this.colorStops.push(t[e]);this._addColorStops(t)},removeColorStopAt:function(t){this.colorStops.splice(t,1),this.setColorStops(this.colorStops)},getGradientType:function(){var t=this.gradientType;return 1==t?"linear":2==t?"radial":"single"},_onLoad:function(){if(-1!=this.obj)var t=n[this.obj].getSVGDocument(),e=t.getElementsByTagName("path")[0]||t.getElementsByTagName("circle")[0]||t.getElementsByTagName("rect")[0]||t.getElementsByTagName("polygon")[0],i=t.getElementsByTagName("svg")[0];else var i=document.getElementById(this.svgid),t=i,e=t.getElementsByTagName("path")[0]||t.getElementsByTagName("circle")[0]||t.getElementsByTagName("rect")[0]||t.getElementsByTagName("polygon")[0];var h=i.getElementsByTagName("linearGradient")[0]||t.getElementsByTagName("radialGradient")[0];if(h){for(var s=h.getElementsByTagName("stop"),r=[],o=0,a=s.length;o<a;o++){var l=s[o],c={};c.offset=l.getAttribute("offset");var u=l.style.stopColor.toString(),d=l.style.stopOpacity;d&&(u=u.replace("rgb","rgba"),u=u.replace(")",","+d+")")),c.color=u,r.push(c)}if("linearGradient"==h.tagName){var f=Number(h.getAttribute("x1")),v=Number(h.getAttribute("x2")),p=Number(h.getAttribute("y1")),g=Number(h.getAttribute("y2"));this.setLinearGradient(f,p,v,g)}else if("radialGradient"==h.tagName){var m=Number(h.getAttribute("cx")),y=Number(h.getAttribute("cy")),x=Number(h.getAttribute("r"));this.setRadialGradient(m,y,0,m,y,x)}this.setColorStops(r)}if("original"==this.color&&(this.color=e.getAttribute("fill")),"original"==this.strokeColor&&(this.strokeColor,e.getAttribute("stroke")),"path"==e.tagName){var b=e.getAttribute("d");this.path=this.parsePath(b)}else if("circle"==e.tagName){var w=e.getAttribute("r"),_=[];_.push({method:"circle",r:w}),this.path=_}else if("polygon"==e.tagName){var C=e.getAttribute("points");this.path=this.parsePolygon(C)}else if("rect"==e.tagName){var S=e.getAttribute("width"),M=e.getAttribute("height"),_=[];_.push({method:"rect",width:S,height:M}),this.path=_}if(void 0==this.spriteWidth&&(this.spriteWidth=parseInt(i.getAttribute("width")),this.spriteHeight=parseInt(i.getAttribute("height")),!this.spriteWidth)){var T=i.getAttribute("viewBox");if(T){var I=T.split(" ");this.spriteWidth=I[2],this.spriteHeight=I[3]}}this.width||(this.width=this.spriteWidth),this.height||(this.height=this.spriteHeight),this.prepared=!0},draw:function(){this.path||this._onLoad();var t=this.path,e=this.ctx,i=0,h=0,s=0,r=0,n=0,o=0,a=this.width,l=this.height,c=a/this.spriteWidth,u=l/this.spriteHeight,d=a/2,f=l/2,v=this._x||this.x,p=this._y||this.y,g=this._rot||this.rot;e.globalAlpha=this.alpha,e.globalCompositeOperation=this.drawMode,e.save(),e.translate(v+d,p+f),e.rotate(g),e.translate(-d,-f),e.scale(c,u),e.beginPath();for(var m=0,y=t.length;m<y;m++){var x=this.path[m],b=x.method;if("moveTo"==b||"horizontalTo"==b||"verticalTo"==b||"quadraticCurveTo"==b||"bezierCurveTo"==b||"lineTo"==b||"bezierCurveShortTo"==b||"quadraticCurveShortTo"==b?(s=0,r=0,(x.x||0==x.x)&&(i=x.x),(x.y||0==x.y)&&(h=x.y)):(s=i,r=h,x.x&&(i+=x.x),x.y&&(h+=x.y)),"circle"==b){var w=x.r;e.arc(i+w,h+w,w,0,2*Math.PI,!1)}else"rect"==b?e.fillRect(i,h,x.width,x.height):"moveTo"==b||"moveBy"==b?e.moveTo(i,h):"lineTo"==b||"lineBy"==b?e.lineTo(i,h):"quadraticCurveBy"==b||"quadraticCurveTo"==b?(e.quadraticCurveTo(s+x.cpx,r+x.cpy,i,h),n=2*i-(s+x.cpx),o=2*h-(r+x.cpy)):"bezierCurveTo"==b||"bezierCurveBy"==b?(e.bezierCurveTo(s+x.cpx1,r+x.cpy1,s+x.cpx2,r+x.cpy2,i,h),n=2*i-(s+x.cpx2),o=2*h-(r+x.cpy2)):"horizontalTo"==b||"horizontalBy"==b?e.lineTo(i,h):"verticalTo"==b||"verticalBy"==b?e.lineTo(i,h):"bezierCurveShortBy"==b||"bezierCurveShortTo"==b?(e.bezierCurveTo(n,o,s+x.cpx2,r+x.cpy2,i,h),n=2*i-(s+x.cpx2),o=2*h-(r+x.cpy2)):"quadraticCurveShortBy"!=b&&"quadraticCurveShortTo"!=b||(e.quadraticCurveTo(n,o,i,h),n=2*i-n,o=2*h-o)}this.closeMode&&e.closePath(),e.fillStyle=this.color,e.fill(),e.strokeStyle=this.strokeColor,this.strokeMode&&e.stroke(),e.restore()},getNodeByName:function(t){for(var e=this.path,i=0,h=e.length;i<h;i++){var s=e[i];if(t==s.name)return s}return-1}}),f.Shape.Box=f.createClass(f.Thing,{initialize:function(t,e,i){this.inherit(e,i),this._basicConstructor="Shape.Box",this.color=t},draw:function(){var t=this.ctx;t.globalAlpha=this.alpha,t.globalCompositeOperation=this.drawMode,t.beginPath(),t.fillStyle=this.color;var e=this._x||this.x,i=this._y||this.y,h=this._rot||this.rot,s=this._width||this.width,r=this._height||this.height,n=e+this.width/2,o=i+this.height/2;t.save(),t.translate(n,o),t.rotate(h),t.translate(-n,-o);var e=this._x||this.x,i=this._y||this.y;t.fillRect(e,i,s,r),t.restore(),t.globalAlpha=1}}),f.Shape.Circle=f.createClass(f.Thing,{initialize:function(t,e){this.inherit(2*e,2*e),this._basicConstructor="Shape.Circle",this.color=t,this.collisionShape="circle"},draw:function(){var t=this.ctx;t.globalAlpha=this.alpha,t.globalCompositeOperation=this.drawMode,t.beginPath(),t.fillStyle=this.color;var e=this._width||this.width,i=e/2,h=this._x||this.x,s=this._y||this.y;t.arc(h+i,s+i,i,0,2*Math.PI,!1),t.fill(),t.globalAlpha=1}}),f.Sprite=f.createClass(f.Thing,{initialize:function(t,e,i){void 0===e&&(e=null,i=null),this.inherit(e,i),this.setImage(t,e,i),this._basicConstructor="Sprite",this.frame=0,this.alpha=1},animate:function(t,e,i){var h=v(this,"animate",i);return h.array=t,h.frameRate=e,h.frameIdx=0,this.mover.push(h),this},_animate:function(t){0==t.time&&(this.frame=t.array[0]),t.time%t.frameRate==0&&(t.frameIdx=(t.frameIdx+1)%t.array.length,this.frame=t.array[t.frameIdx])},setSpriteSize:function(t,e){this.spriteWidth=t,this.spriteHeight=e},setImage:function(t,e,i){e&&i&&this.setSpriteSize(e,i);for(var h=s.length,r=0;r<h;r++)s[r].name==t&&(this.img=r)},getImage:function(){return s[this.img]},isLoaded:function(){return!(!this.getImage().loaded||!this.ctx)},_onLoad:function(){var t=this.getImageSize();!this.width&&t.width&&(this.setSpriteSize(t.width,t.height),this.width||(this.setSize(t.width,t.height),this._scaleX&&this.scale(this._scaleX,this._scaleY))),this.prepared=!0},getImageSize:function(){var t={},e=s[this.img];return t.width=e.width,t.height=e.height,t},draw:function(){var t=this.ctx;t.globalAlpha=this.alpha,t.globalCompositeOperation=this.drawMode;var e=this.frame,i=s[this.img],h=this.spriteWidth,r=this.spriteHeight,n=this._width||this.width,o=this._height||this.height,a=n/2,l=o/2,c=i.width/h,u=i.height/r,d=n/h,f=o/r,v=e%c*h,p=~~(e/c)%u*r,g=this._x||this.x,m=this._y||this.y,y=this._rot||this.rot;t.save(),t.translate(g+a,m+l),t.rotate(y),t.translate(-a,-l),t.scale(d,f),null!=v&&t.drawImage(i,v,p,h,r,0,0,h,r),t.restore(),t.globalAlpha=1}}),f.Map=f.createClass(f.Sprite,{initialize:function(t,e,i){this.inherit(t,e,i),this.drawData,this.hitData},intersect:function(t,e){for(var i=this.hitData,h=i[0].length,s=i.length,r=this._width||this.width,n=this._height||this.height,o=this._x||this.x,a=this._y||this.y,l=0;l<s;l++)for(var c=0;c<h;c++)if(1==i[l][c]&&o+c*r<t&&t<o+(c+1)*r&&a+l*n<e&&e<a+(l+1)*n)return!0;return!1},draw:function(){var t=this.drawData;if(t&&t[0]){var e=t[0].length,i=t.length,h=this._width||this.width,r=this._height||this.height,n=this._x||this.x,o=this._y||this.y,a=0,l=0,c=this.field,u=this.ctx;u.globalAlpha=this.alpha,u.globalCompositeOperation=this.drawMode;for(var d,f=c.height,v=c.width,p=s[this.img],g=this.spriteWidth,m=this.spriteHeight,y=p.width/g,x=p.height/m,b=this.width/g,w=this.height/m,_=n,C=o;a<i;){for(;l<e;){if((d=t[a][l])>=0&&f>o+r*a&&o+r*(a+1)>0&&v>n+h*l&&n+h*(l+1)>0){var S=d%y*g,M=~~(d/y)%x*m;u.save(),u.translate(_,C),u.scale(b,w),u.drawImage(p,S,M,g,m,0,0,g,m),u.restore()}_+=h,l++}C+=r,_=n,a++,l=0}}}}),f.Text=f.createClass(f.Util,{initialize:function(t,e,i,h){this.inherit(),this._basicConstructor="Text",this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.alpha=1,this.spaceWidth=7,this.font=h?"'"+h+"'":"'Meiryo'",this.size=i?i+"px":"10px",this.string=t||"",this.color=e||"white"},setSize:function(t){this.size=t+"px"},setFont:function(t){this.font="'"+t+"'"},intersect:function(t,e){var i=this._x||this.x,h=this._y||this.y,s=parseInt(this.size)*this.scaleX*this.string.length,r=parseInt(this.size)*this.scaleY,n=t-(i+s/2),o=e-(h+r/2),a=this._rot||this.rot,l=Math.sin(-a),c=Math.cos(-a),u=Math.abs(n*c-o*l),d=Math.abs(n*l+o*c);return u<s/2&&d<r/2},scale:function(t,e){this.scaleX*=t,this.scaleY*=e},_scaleBy:function(t){0==t.time&&(t.diffWidth=t.scaleX-this.scaleX,t.diffHeight=t.scaleY-this.scaleY),this.scaleX=t.scaleX-t.diffWidth*(1-t.time/t.frame),this.scaleY=t.scaleY-t.diffHeight*(1-t.time/t.frame)},draw:function(){var t=this._x||this.x,e=this._y||this.y,i=this._rot||this.rot,h=this.scaleX,s=this.scaleY,r=this.ctx,n=this.string.split("<br>"),o=n.length;r.globalAlpha=this.alpha,r.globalCompositeOperation=this.drawMode,r.font=this.size+" "+this.font;var a=1.5*r.measureText("a").width+this.spaceWidth;r.fillStyle=this.color,r.save();var l=parseInt(this.size)*this.scaleX*this.string.length/2,c=parseInt(this.size)*this.scaleY/2;r.translate(t+l,e+c),r.rotate(i),r.translate(-l,-c),r.scale(h,s);for(var u=0;u<o;u++)r.fillText(n[u],0,a),a*=2;r.restore(),r.globalAlpha=1}}),f.Group=f.createClass(f.Thing,{initialize:function(){this.children=[],this.inherit(),this.x=0,this.y=0,this._basicConstructor="Group"},addChild:function(t){t.parent=this,this.children.push(t),this.parent&&(t.ctx=this.parent.ctx,t.field=this.parent.field,this.parent.children.push(t))},addChildren:function(){for(var t=0,e=arguments.length;t<e;t++)this.addChild(arguments[t])},getChild:function(t){var e=this.getChildren(t),i=e[0];return i||(i=null),i},getChildren:function(t){for(var e=[],i=this.children,h=0,s=i.length;h<s;h++){var r=!0;for(var n in t)if("$not"==n)for(var o in t.$not)t.$not[o]==i[h][o]&&(r=!1);else t[n]!=i[h][n]&&(r=!1);1==r&&e.push(i[h])}return e},removeChild:function(t){this.getChild(t).remove()},removeChildren:function(t){for(var e=this.getChildren(t),i=0,h=e.length;i<h;i++)e[i].remove()
},draw:function(){}}),f.Scene=f.createClass(f.Group,{initialize:function(){this.inherit(),this._basicConstructor="Scene",this._remove=!1},addChild:function(t){if(t.parent=this,this.ctx&&this.field&&(t.ctx=this.ctx,t.field=this.field),this.children.push(t),"Group"==t._basicConstructor||"Layer"==t._basicConstructor)for(var e=t.children,i=0,h=e.length;i<h;i++){var s=e[i];s.ctx||(s.ctx=this.ctx,s.field=this.field,this.children.push(s))}},setImage:function(t){this.image=t},setColor:function(t){this.color=t},_enterFrame:function(t){this.enterFrame&&this.enterFrame();for(var e=this.children,i=0,h=e.length;i<h;i++){var s=e[i];s._remove?(e.splice(i,1),s=null,i--,h--):("Sprite"!=s._basicConstructor&&"Map"!=s._basicConstructor&&"Shape"!=s._basicConstructor||s.isLoaded()&&!s.prepared&&(s._onLoad(),s.onLoad&&s.onLoad()),s.useEvent&&s.useEvent(),s._enterFrame&&s._enterFrame(),s.enterFrame&&s.enterFrame(),s.tween&&s.tween(),s.visible&&s.draw())}}}),f.Layer=f.createClass(f.Group,{initialize:function(){this.inherit(),this.rot=0,this._basicConstructor="Layer",this.firstWidth=100,this.firstHeight=100,this.height=100,this.width=100,this.scaleX=1,this.scaleY=1},fitToChildren:function(){var t=this.children,e=this.x,i=this.y;this.x=null,this.y=null,this.width=0,this.height=0;for(var h=0,s=t.length;h<s;h++){var r=t[h],n=r._x||r.x,o=r._y||r.y,a=r._width||r.width,l=r._height||r.height,c=n+a/2,u=o+l/2,d=r._rot||r.rot;if(d%=2*Math.PI,d<0&&(d+=2*Math.PI),0<=d&&d<=Math.PI/2)var f=Math.cos(d)*(n-c)-Math.sin(d)*(o+l-u)+c,v=Math.cos(d)*(n+a-c)-Math.sin(d)*(o-u)+c,p=Math.sin(d)*(n-c)+Math.cos(d)*(o-u)+u,g=Math.sin(d)*(n+a-c)+Math.cos(d)*(o+l-u)+u;else if(Math.PI/2<d&&d<=Math.PI)var f=Math.cos(d)*(n+a-c)-Math.sin(d)*(o+l-u)+c,v=Math.cos(d)*(n-c)-Math.sin(d)*(o-u)+c,p=Math.sin(d)*(n-c)+Math.cos(d)*(o+l-u)+u,g=Math.sin(d)*(n+a-c)+Math.cos(d)*(o-u)+u;else if(Math.PI<d&&d<=1.5*Math.PI)var f=Math.cos(d)*(n+a-c)-Math.sin(d)*(o-u)+c,v=Math.cos(d)*(n-c)-Math.sin(d)*(o+l-u)+c,p=Math.sin(d)*(n+a-c)+Math.cos(d)*(o+l-u)+u,g=Math.sin(d)*(n-c)+Math.cos(d)*(o-u)+u;else if(1.5*Math.PI<d&&d<=2*Math.PI)var f=Math.cos(d)*(n-c)-Math.sin(d)*(o-u)+c,v=Math.cos(d)*(n+a-c)-Math.sin(d)*(o+l-u)+c,p=Math.sin(d)*(n+a-c)+Math.cos(d)*(o-u)+u,g=Math.sin(d)*(n-c)+Math.cos(d)*(o+l-u)+u;(!this.x||this.x>f)&&(this.x=f),(!this.y||this.y>p)&&(this.y=p),this.width<v&&(this.width=v),this.height<g&&(this.height=g)}this.width-=this.x,this.height-=this.y,this.firstWidth=this.width,this.firstHeight=this.height;for(var h=0,s=t.length;h<s;h++){var r=t[h];r._x?(r.x+=e-this.x,r.y+=i-this.y):(r._x=r.x,r._y=r.y,r.x-=this.x,r.y-=this.y)}return this},releaseChild:function(t){var e=this.parent;t.x=t._x,t.y=t._y,t.width=t._width,t.height=t._height,t.rot=t._rot,t._x=null,t._y=null,t._width=null,t._height=null,t._rot=null,t.grouped=!1,t._leave=!1,t.parent=e},releaseAllChildren:function(){for(var t=this.children,e=0,i=t.length;e<i;e++){var h=t[e];this.releaseChild(h)}return this.children=[],this._remove=!0,this},removeChildrenByProperty:function(t){for(var e=this.getChildren(t),i=0,h=e.length;i<h;i++)e[i].remove();return this},removeAllChildren:function(){for(var t=this.children,e=(this.parent,0),i=t.length;e<i;e++)t[e].remove();return this},_setAbsPos:function(t){var e=this.width/2,i=this.height/2,h=this.rot;t.Cx=this.scaleX*t.x+t._width/2,t.Cy=this.scaleY*t.y+t._height/2,t.startRot=!0;var s=Math.cos(h)*(t.Cx-e)-Math.sin(h)*(t.Cy-i)+e,r=Math.sin(h)*(t.Cx-e)+Math.cos(h)*(t.Cy-i)+i;t._x=s-t._width/2,t._y=r-t._height/2,t._x+=this.x,t._y+=this.y},draw:function(){var t=this.children;this.scaleX=this.width/this.firstWidth,this.scaleY=this.height/this.firstHeight;for(var e=0,i=t.length;e<i;e++){var h=t[e];h._leave||h._remove?(t.splice(e,1),this.releaseChild(h),e--,i--):(h._rot=h.rot+this.rot,h._width=this.scaleX*h.width,h._height=this.scaleY*h.height,this._setAbsPos(h))}}}),i.default=f,e.exports=i.default},{}]},{},[1])(1)});