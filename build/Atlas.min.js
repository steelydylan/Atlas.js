/**
 * Modules in this bundle
 * @license
 *
 * @steelydylan/atlasjs:
 *   license: MIT License
 *   homepage: http://horicdesign.com
 *   version: 0.7.13
 *
 * This header is generated by licensify (https://github.com/twada/licensify)
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Atlas=t()}}(function(){return function(){function t(e,i,r){function h(s,o){if(!i[s]){if(!e[s]){var n="function"==typeof require&&require;if(!o&&n)return n(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){return h(e[s][1][t]||t)},u,u.exports,t,e,i,r)}return i[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)h(r[s]);return h}return t}()({1:[function(t,e,r){"use strict";function h(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),u=[],c=[],d=[],v=0,f=function(){var t=navigator.userAgent;return t.indexOf("iPhone")>0&&-1==t.indexOf("iPad")||t.indexOf("iPod")>0||t.indexOf("Android")>0}(),y=function(t){var e=window.matchMedia("(orientation: portrait)");return e.matches?"portrait":"landscape"}(),p=function(t,e){var i=e.which;switch(i){case 13:t.enter=!0;break;case 16:t.shift=!0;break;case 32:t.space=!0;break;case 39:t.right=!0;break;case 37:t.left=!0;break;case 38:t.up=!0;break;case 40:t.down=!0;break;case 8:t.backspace=!0}e.metaKey&&(t.command=!0);for(var r=0;r<26;r++)if(r+65==i){var h=String.fromCharCode(r+97);t[h]=!0;break}},g=function(t){t.enter=!1,t.command=!1,t.shift=!1,t.space=!1,t.right=!1,t.left=!1,t.up=!1,t.down=!1,t.backspace=!1;for(var e=0;e<26;e++)t[String.fromCharCode(e+97)]=!1},m=function(){var t={};return g(t),t}(),x=function t(){for(var e in t)window[e]=t[e]};x.main=function(t){x._main=t},window.addEventListener("load",function(){x._main&&x._main()});var _=function(t,e,i){var r=t.mover,h=r[r.length-1],a={};return h&&h.and&&(a=h),a.time=0,i&&(a.frame=i),a.loop=!1,a.and=!1,a[e]=!0,a},b=r.Util=function(){function t(){s(this,t),this.isMobile=f,this.orientation=y,this.eventListener={},this.mover=[],this.rot=0,this.moverIndex=0,this.visible=!0,this.eventEnable=!0,this.drawMode="source-over";var e=this.eventListener;e.touchStart=!1,e.touchMove=!1,e.touchEnd=!1,e.keyUp=!1,e.keyDown=!1,e.multiTouchStart=!1,e.multiTouchMove=!1,e.multiTouchEnd=!1,e.orientationChange=!1}return l(t,[{key:"tween",value:function(){var t=this.mover,e=t.length;if(this.moverIndex<e){var i=t[this.moverIndex];i.animate&&this._animate(i),i.moveTo&&this._moveTo(i),i.moveBy&&this._moveBy(i),i.rotateBy&&this._rotateBy(i),i.scaleBy&&this._scaleBy(i),i.then&&this._then(i),i.time++,i.time>=i.frame&&++this.moverIndex==e&&(i.loop?this._refresh():this.stop())}}},{key:"isQueEmpty",value:function(){return!this.mover.length}},{key:"_refresh",value:function(){this.moverIndex=0;for(var t=this.mover,e=0,i=t.length;e<i;e++){var r=t[e];r.time&&(r.time=0)}}},{key:"moveTo",value:function(t,e,i){var r=_(this,"moveTo",i);return r.toX=t,r.toY=e,this.mover.push(r),this}},{key:"_moveTo",value:function(t){0===t.time&&(t.diffX=t.toX-this.x,t.diffY=t.toY-this.y),this.x=t.toX-t.diffX*(1-t.time/t.frame),this.y=t.toY-t.diffY*(1-t.time/t.frame)}},{key:"moveBy",value:function(t,e,i){var r=_(this,"moveBy",i);return r.diffX=t,r.diffY=e,this.mover.push(r),this}},{key:"_moveBy",value:function(t){0===t.time&&(t.toX=this.x+t.diffX,t.toY=this.y+t.diffY),this.x=t.toX-t.diffX*(1-t.time/t.frame),this.y=t.toY-t.diffY*(1-t.time/t.frame)}},{key:"delay",value:function(t){var e=_(this,"delay",t);return this.mover.push(e),this}},{key:"and",value:function(){var t=this.mover,e=t[t.length-1];return e&&(e.and=!0),this}},{key:"stop",value:function(){return this.mover=[],this.moverIndex=0,this}},{key:"loop",value:function(){return this.mover[this.mover.length-1].loop=!0,this}},{key:"rotateBy",value:function(t,e){var i=_(this,"rotateBy",e);return this.mover.push(i),i.diffAngle=t,this}},{key:"_rotateBy",value:function(t){0===t.time&&(t.toAngle=this.rot+t.diffAngle),this.rot=t.toAngle-t.diffAngle*(1-t.time/t.frame)}},{key:"then",value:function(t,e){var i=_(this,"then",e);return i.exec=t,this.mover.push(i),this}},{key:"_then",value:function(t){t.exec.call(this)}},{key:"scaleBy",value:function(t,e,i){var r=_(this,"scaleBy",i);return r.scaleX=t,r.scaleY=e,this.mover.push(r),this}},{key:"setPosition",value:function(t,e){return this.x=t,this.y=e,this}},{key:"saveData",value:function(t){var e={};for(var i in this)"function"!=typeof this[i]&&(e[i]=this[i]);localStorage.setItem(t,JSON.stringify(e))}},{key:"getData",value:function(t){var e=JSON.parse(localStorage.getItem(t));for(var i in e)this[i]=e[i]}},{key:"getTouchPosition",value:function(t,e){e&&t.touches[e]||(e=0);var i=this.field,r=parseInt(i.width)/parseInt(i.style.width),h=parseInt(i.height)/parseInt(i.style.height),a={},s=i.getBoundingClientRect(),o=parseInt(s.left),n=parseInt(s.top);isNaN(o)&&(o=0),isNaN(n)&&(n=0);var l=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop;return t?!f||f&&t.touches[e]?(a.x=(f?t.touches[e].pageX:t.pageX)-o-l,a.y=(f?t.touches[e].pageY:t.pageY)-n-u):(a.x=-1,a.y=-1):(a.x=event.x-o,a.y=event.y-n),a.x=parseInt(a.x*r),a.y=parseInt(a.y*h),a}},{key:"getMultiTouchPosition",value:function(t){for(var e=t.touches.length,i=[],r=0;r<e;r++)i[r]=this.getTouchPosition(t,r);return i}},{key:"handleEvent",value:function(t){if(this.eventEnable){t.preventDefault();var e=this.getTouchPosition(t);t.touches?e.touchCount=t.touches.length:e.touchCount=1,e.event=t;switch(t.type){case"touchstart":this.multiTouchStart&&t.touches.length>1?this.multiTouchStart(this.getMultiTouchPosition(t)):this.touchStart&&this.touchStart(e);break;case"mousedown":this.touchStart&&this.touchStart(e);break;case"touchmove":this.multiTouchMove&&t.touches.length>1?this.multiTouchMove(this.getMultiTouchPosition(t)):this.touchMove&&this.touchMove(e);break;case"mousemove":this.touchMove&&this.touchMove(e);break;case"touchend":this.multiTouchEnd&&t.touches.length>1?this.multiTouchEnd(this.getMultiTouchPosition(t)):this.touchEnd&&this.touchEnd(e);break;case"mouseup":this.touchEnd&&this.touchEnd();break;case"keydown":this.keyDown&&this.keyDown(m);break;case"keyup":this.keyUp&&this.keyUp()}}}},{key:"useEvent",value:function(){var t=this.field,e=this.eventListener;this.touchStart&&!1===e.touchStart&&(f?t.addEventListener("touchstart",this,!1):t.addEventListener("mousedown",this,!1),e.touchStart=!0),this.touchMove&&!1===e.touchMove&&(f?t.addEventListener("touchmove",this,!1):t.addEventListener("mousemove",this,!1),e.touchMove=!0),this.touchEnd&&!1===e.touchEnd&&(f?t.addEventListener("touchend",this,!1):t.addEventListener("mouseup",this,!1),e.touchEnd=!0),this.multiTouchStart&&!1===e.multiTouchStart&&(e.touchStart||(f?t.addEventListener("touchstart",this,!1):t.addEventListener("mousedown",this,!1)),e.touchStart=!0),this.multiTouchMove&&!1===e.multiTouchMove&&(e.touchMove||(f?t.addEventListener("touchmove",this,!1):t.addEventListener("mousemove",this,!1)),e.touchMove=!0),this.multiTouchEnd&&!1===e.multiTouchEnd&&(e.touchEnd||(f?t.addEventListener("touchend",this,!1):t.addEventListener("mouseup",this,!1)),e.touchEnd=!0),this.keyUp&&!1===e.keyUp&&(t.addEventListener("keyup",this,!1),e.keyUp=!0),this.keyDown&&!1===e.keyDown&&(t.addEventListener("keydown",this,!1),e.keyDown=!0)}},{key:"remove",value:function(){this._remove=!0}},{key:"leave",value:function(){this._leave=!0}},{key:"getRand",value:function(t,e){return~~(Math.random()*(e-t+1))+t}},{key:"getRandText",value:function(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=i.length,h=0;h<t;h++)e+=i.charAt(Math.floor(this.getRand(0,r)));return e}},{key:"rgbToHex",value:function(t,e,i){return"#"+(16777216+(i|e<<8|t<<16)).toString(16).slice(1)}},{key:"hexToRgb",value:function(t,e){(void 0===t?"undefined":o(t))===Number&&(e=t,t=null);var i=t||this.color,r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return e?r?"rgba("+parseInt(r[1],16)+","+parseInt(r[2],16)+","+parseInt(r[3],16)+","+e+")":null:r?"rgb("+parseInt(r[1],16)+","+parseInt(r[2],16)+","+parseInt(r[3],16)+")":null}},{key:"hsvToHex",value:function(t,e,i){var r=void 0,h=void 0,a=void 0,s=void 0,o=void 0,n=void 0,l=void 0,u=void 0;switch(h=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),a=Math.round(i*(1-e/255)),s=Math.round(i*(1-e/255*r)),o=Math.round(i*(1-e/255*(1-r))),h){case 0:n=i,l=o,u=a;break;case 1:n=s,l=i,u=a;break;case 2:n=a,l=i,u=o;break;case 3:n=a,l=s,u=i;break;case 4:n=o,l=a,u=i;break;case 5:n=i,l=a,u=s}return n=n<=15?"0"+n.toString(16):n.toString(16),l=l<=15?"0"+l.toString(16):l.toString(16),u=u<=15?"0"+u.toString(16):u.toString(16),"#"+n+l+u}},{key:"rgbToHsv",value:function(t,e,i){var r=void 0,h=void 0,a=void 0,t=t/255,e=e/255,i=i/255,s=void 0,o=void 0,n=void 0;n=Math.max(t,e,i);var l=n-Math.min(t,e,i);return 0==l?s=o=0:(o=l/n,r=(n-t)/6/l+.5,h=(n-e)/6/l+.5,a=(n-i)/6/l+.5,t===n?s=a-h:e===n?s=1/3+r-a:i===n&&(s=2/3+h-r),s<0?s+=1:s>1&&(s-=1)),"hsv("+Math.round(360*s)+","+Math.round(100*o)+","+Math.round(100*n)+")"}},{key:"hexToHsv",value:function(t){this.hexToRgb(t)}},{key:"getObjFromRgb",value:function(t){var e=/rgb\((.*?),(.*?),(.*?)\)/.exec(t);return{r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])}}},{key:"getObjFromHsv",value:function(t){var e=/hsv\((.*?),(.*?),(.*?)\)/.exec(t);return{h:parseInt(e[1]),s:parseInt(e[2]),v:parseInt(e[3])}}},{key:"getSound",value:function(t){for(var e=0,i=c.length;e<i;e++)t==c[e].name&&(this.sound=new Audio(c[e].src))}},{key:"soundClonePlay",value:function(){var t=this.sound;t&&new Audio(t.src).play()}},{key:"soundLoopPlay",value:function(){var t=this.sound;t&&(t.loop||t.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),t.loop=!0,t.play())}},{key:"soundReplay",value:function(){var t=this.sound;t&&(t.load(),t.play())}},{key:"soundStop",value:function(){var t=this.sound;t.paused?t.load():(t.pause(),t.currentTime=0)}},{key:"soundPlay",value:function(){var t=this.sound;t&&t.play()}},{key:"soundPause",value:function(){var t=this.sound;t&&t.pause()}},{key:"soundGetCount",value:function(){var t=this.sound;if(t)return t.currentTime}},{key:"soundSetCount",value:function(t){var e=this.sound;e&&(e.currentTime=t)}},{key:"soundGetVolume",value:function(){var t=this.sound;if(t)return t.volume}},{key:"soundSetVolume",value:function(t){var e=this.sound;e&&(e.volume=t)}},{key:"soundGetAlltime",value:function(){var t=this.sound;if(t)return t.duration}},{key:"soundIsPlaying",value:function(){var t=this.sound;if(t)return!t.paused}},{key:"getExtention",value:function(t){var e=void 0;if(!t)return e;var i=t.split("."),r=i.length;return 0===r?e:e=i[r-1]}}]),t}(),k=(r.App=function(t){function e(t){s(this,e);var i=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));i._basicConstructor="App";var r=document.createElement("style");r.media="screen",r.type="text/css",document.getElementsByTagName("head")[0].appendChild(r);var a=void 0;if(t)a=document.getElementById(t);else{a=document.createElement("canvas");document.getElementsByTagName("body").item(0).appendChild(a)}a.width=320,a.height=480,a.style.top="0px",a.style.left="0px",a.tabIndex="1",document.body.style.margin="0em";navigator.userAgent;return f?(a.style.width=window.innerWidth+"px",a.style.height=window.innerHeight+"px",a.addEventListener("touchstart",function(){-1!=this.tabIndex&&this.focus()})):(a.style.width="480px",a.style.height="620px",a.addEventListener("mousedown",function(){-1!=this.tabIndex&&this.focus()}),a.addEventListener("keyup",function(){g(m)},!1),a.addEventListener("keydown",function(t){p(m,t)})),i._css=r,i.field=a,i.ctx=a.getContext("2d"),i.fps=30,i.scene=new M,i.scene.ctx=i.ctx,i.scene.field=i.field,i.scene.parent=i,i}return a(e,t),l(e,[{key:"clearLockMode",value:function(){this.field.tabIndex="-1"}},{key:"setLockMode",value:function(){this.field.tabIndex="1"}},{key:"getCanvasURL",value:function(){return this.field.toDataURL()}},{key:"getCanvasImage",value:function(){var t=this.field.toDataURL();window.open(t,"_blank")}},{key:"getChild",value:function(t){return this.scene.getChild(t)}},{key:"getChildren",value:function(t){return this.scene.getChildren(t)}},{key:"colorToAlpha",value:function(t,e){for(var i=void 0,r=0,h=u.length;r<h;r++)u[r].name==t&&(i=u[r],i.hex=e,i.index=r);i.addEventListener("load",function(){var t=document.createElement("canvas"),e=t.getContext("2d"),i=this.width,r=this.height,h=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,a=this.hex.replace(h,function(t,e,i,r){return e+e+i+i+r+r}),s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a),o=s?{r:parseInt(s[1],16),g:parseInt(s[2],16),b:parseInt(s[3],16)}:null;e.drawImage(this,0,0);for(var n=e.getImageData(0,0,i,r),l=n.data,c=0;c<r;c++)for(var d=0;d<i;d++){var v=c*(4*i)+4*d;l[v]==o.r&&l[v+1]==o.g&&l[v+2]==o.b&&(l[v+3]=0)}e.putImageData(n,0,0);var f=new Image;f.src=t.toDataURL(),u[this.index]=f})}},{key:"addChild",value:function(t){t.ctx=this.ctx,t.field=this.field,this.scene.addChild(t)}},{key:"addChildren",value:function(){for(var t=0,e=arguments.length;t<e;t++)this.addChild(arguments[t])}},{key:"centerize",value:function(){var t=this.field.style;t.marginTop=-parseInt(t.height)/2+"px",t.marginLeft=-parseInt(t.width)/2+"px",t.top="50%",t.left="50%",t.position="absolute"}},{key:"fitWindow",value:function(){this.setSize(window.innerWidth,window.innerHeight);var t=this;window.onresize=function(){t.setSize(window.innerWidth,window.innerHeight)}}},{key:"setQuality",value:function(t,e){var i=this.field;i.width=t,i.height=e}},{key:"setSize",value:function(t,e){var i=this.field.style;i.width=t+"px",i.height=e+"px"}},{key:"getSize",value:function(){var t={};return t.width=parseInt(this.field.style.width),t.height=parseInt(this.field.style.height),t}},{key:"getQuality",value:function(){var t={};return t.width=parseInt(this.field.width),t.height=parseInt(this.field.height),t}},{key:"loadingScene",value:function(t){this.preScene=t,this.preScene.parent=this}},{key:"_preLoadEnterFrame",value:function(){var t=this.field;if(this.useEvent(),this.ctx.clearRect(0,0,t.width,t.height),v>0)this.preScene&&this.preScene._enterFrame();else{this.onLoad&&this.onLoad();for(var e=this.scene.children,i=0,r=e.length;i<r;i++){var h=e[i];h._onLoad&&h._onLoad(),h.onLoad&&h.onLoad()}clearInterval(this.preLoadInterval);var a=this;setInterval(function(){a._enterFrame()},1e3/this.fps)}}},{key:"_enterFrame",value:function(){var t=this.field;this.ctx.clearRect(0,0,t.width,t.height),this.useEvent(),this.enterFrame&&this.enterFrame(),this.scene._enterFrame()}},{key:"pushScene",value:function(t){for(var e=this.ctx,r=this.field,h=this.scene.children,a=0,s=h.length;a<s;a++){var o=h[a];o.eventEnable=!1,o.onSceneremoved&&o.onSceneRemoved()}for(h=t.children,i=0,n=h.length;i<n;i++){var l=h[i];l.ctx=e,l.field=r,l.eventEnable=!0,l.onScenePushed&&l.onScenePushed()}t.parent=this,t.ctx=e,t.field=r;var u=this.field.style;u.background=null,u.backgroundColor="white",t.color&&this.setColor(t.color),t.image&&this.setImage(t.image),this.scene=t}},{key:"setColor",value:function(t){var e=this.field.style;e.background=null,e.backgroundColor=t}},{key:"setImage",value:function(t){var e=this.field.style;e.background="url("+t+") no-repeat center",e.backgroundSize="cover"}},{key:"start",value:function(){var t=this.field,e=this;this.ctx.clearRect(0,0,t.width,t.height),this.preLoadInterval=setInterval(function(){e._preLoadEnterFrame()},1e3/this.fps)}},{key:"load",value:function(){for(var t=function(){v--,console.log(this.src+" is loaded")},e=function(){v--,this.style.display="none",this.loaded=!0,console.log(this.data+" is loaded")},i=function(){v--,this.loaded=!0,console.log(this.src+" is loaded")},r=0,h=arguments.length;r<h;r++){var a=arguments[r],s=a,o=a;if(a instanceof Array)var s=a[0],o=a[1];if(s.match("data:image/png"))var n="png";else var n=this.getExtention(s);if("wav"==n||"mp3"==n||"ogg"==n){var a=new Audio(s);a.name=o,v++,a.addEventListener("canplaythrough",t),c.push(a)}else if("TTF"==n||"ttf"==n){var l=this._css,f=document.createTextNode("@font-face{font-family:'"+o+"';src: url('"+s+"') format('truetype');}");l.styleSheet?l.styleSheet.cssText=f:l.appendChild(f)}else if("svg"==n){var a=document.createElement("object");a.addEventListener("load",e),a.data=s,a.name=o,document.body.appendChild(a),v++,d.push(a)}else if("png"==n||"gif"==n||"jpeg"==n||"jpg"==n){var a=new Image;a.addEventListener("load",i),a.src=s,a.name=o,v++,u.push(a)}}}}]),e}(b),r.Thing=function(t){function e(t,i){s(this,e);var r=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.x=0,r.y=0,r._remove=!1,r.width=t,r.height=i,r.collisionShape="box",r.prepared=!1,r.alpha=1,r}return a(e,t),l(e,[{key:"_scaleBy",value:function(t){0===t.time&&(t.toWidth=this.width*t.scaleX,t.toHeight=this.height*t.scaleY,t.diffWidth=t.toWidth-this.width,t.diffHeight=t.toHeight-this.height),this.width=t.toWidth-t.diffWidth*(1-t.time/t.frame),this.height=t.toHeight-t.diffHeight*(1-t.time/t.frame)}},{key:"intersect",value:function(t,e){var i=this._x||this.x,r=this._y||this.y,h=this._width||this.width,a=this._height||this.height,s=this._rot||this.rot;if("box"==this.collisionShape){var o=t-(i+h/2),n=e-(r+a/2),l=Math.sin(-s),u=Math.cos(-s),c=Math.abs(o*u-n*l),d=Math.abs(o*l+n*u);return c<h/2&&d<a/2}if("circle"==this.collisionShape){var v=h/2,o=t-(i+v),n=e-(r+v);return Math.sqrt(o*o+n*n)<v}return!1}},{key:"hitTest",value:function(t){var e=this._x||this.x,i=this._y||this.y,r=this._width||this.width,h=this._height||this.height,a=e+r/2,s=i+h/2,o=t._x||t.x,n=t._y||t.y,l=t._width||t.width,u=t._height||t.height,c=t._rot||t.rot;if("box"!=this.collisionShape)return"circle"==this.collisionShape&&this.within(t,r/2);if("circle"==t.collisionShape)return t.within(this,l/2);if(0!==c&&c!=Math.PI&&"box"==t.collisionShape){var d=o+l/2,v=n+u/2,f=-c;a=Math.cos(f)*(a-d)-Math.sin(f)*(s-v)+d,s=Math.sin(f)*(a-d)+Math.cos(f)*(s-v)+v,e=a-r/2,i=s-h/2}return e<o+l&&o<e+r&&i<n+u&&n<i+h}},{key:"within",value:function(t,e){var i=this._x||this.x,r=this._y||this.y,h=this._width||this.width,a=this._height||this.height,s=(this._rot||this.rot,t._x||t.x),o=t._y||t.y,n=t._width||t.width,l=t._height||t.height,u=t._rot||t.rot;if("box"==this.collisionShape)var c=i+h/2,d=r+a/2;else{if("circle"!=this.collisionShape)return!1;var v=h/2,c=i+v,d=r+v}if("box"==t.collisionShape){var f,y,p=s+n/2,g=o+l/2,m=-u,x=Math.cos(m)*(c-p)-Math.sin(m)*(d-g)+p,_=Math.sin(m)*(c-p)+Math.cos(m)*(d-g)+g;f=x<s?s:x>s+n?s+n:x,y=_<o?o:_>o+l?o+l:_;var b=Math.abs(x-f),k=Math.abs(_-y)}else{if("circle"!=t.collisionShape)return!1;var w=n/2,f=s+w,y=o+w,b=Math.abs(c-f),k=Math.abs(d-y);e+=w}return Math.sqrt(b*b+k*k)<e}},{key:"scale",value:function(t,e){return this.width?(this.width*=t,this.height*=e):(this._scaleX=t,this._scaleY=e),this}},{key:"setSize",value:function(t,e){this.width=t,this.height=e}}]),e}(b)),w=(r.Shape=function(t){function e(t,i,r){s(this,e);var a=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,0,0));return a.obj=-1,a.svgid=-1,a._basicConstructor="Shape",a.color=i||"original",a.strokeColor=r||"original",a.colorStops=[],"svg"!=a.getExtention(t)?a.svgid=t:a.setImage(t),a.closeMode=!0,a.strokeMode=!0,a}return a(e,t),l(e,[{key:"setSpriteSize",value:function(t,e){this.spriteWidth=t,this.spriteHeight=e}},{key:"setImage",value:function(t){for(var e=0,i=d.length;e<i;e++)t==d[e].name&&(this.obj=e)}},{key:"getImage",value:function(){return d[this.obj]}},{key:"getImageName",value:function(){return d[this.obj].data}},{key:"parsePolygon",value:function(t){for(var e=t.split(" "),i=[],r=0,h=e.length-1;r<h;r++){var a=e[r].split(","),s=Number(a[0]),o=Number(a[1]),n={method:"lineTo",x:s,y:o};i.push(n)}return i}},{key:"parsePath",value:function(t){var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},i=/([astvzqmhlc])([^astvzqmhlc]*)/gi,r=[];return t.replace(i,function(t,i,h){var a=i.toLowerCase();for(h=h.match(/-?[.0-9]+(?:e[-+]?\d+)?/gi),h=h?h.map(Number):[],"m"==a&&h.length>2&&(r.push([i].concat(h.splice(0,2))),a="l",i="m"==i?"l":"L");;){if(h.length==e[a]){if(h.unshift(i),"q"==h[0])var s={method:"quadraticCurveBy",cpx:h[1],cpy:h[2],x:h[3],y:h[4]};else if("Q"==h[0])var s={method:"quadraticCurveTo",cpx:h[1],cpy:h[2],x:h[3],y:h[4]};else if("l"==h[0])var s={method:"lineBy",x:h[1],y:h[2]};else if("L"==h[0])var s={method:"lineTo",x:h[1],y:h[2]};else if("m"==h[0])var s={method:"moveBy",x:h[1],y:h[2]};else if("M"==h[0])var s={method:"moveTo",x:h[1],y:h[2]};else if("c"==h[0])var s={method:"bezierCurveBy",cpx1:h[1],cpy1:h[2],cpx2:h[3],cpy2:h[4],x:h[5],y:h[6]};else if("C"==h[0])var s={method:"bezierCurveTo",cpx1:h[1],cpy1:h[2],cpx2:h[3],cpy2:h[4],x:h[5],y:h[6]};else if("h"==h[0])var s={method:"horizontalBy",x:h[1]};else if("H"==h[0])var s={method:"horizontalTo",x:h[1]};else if("v"==h[0])var s={method:"verticalBy",y:h[1]};else if("V"==h[0])var s={method:"verticalTo",y:h[1]};else if("s"==h[0])var s={method:"bezierCurveShortBy",cpx2:h[1],cpy2:h[2],x:h[3],y:h[4]};else if("S"==h[0])var s={method:"bezierCurveShortTo",cpx2:h[1],cpy2:h[2],x:h[3],y:h[4]};else if("t"==h[0])var s={method:"quadraticCurveShortBy",x:h[1],y:h[2]};else if("T"==h[0])var s={method:"quadraticCurveShortTo",x:h[1],y:h[2]};else var s={};return r.push(s)}r.push([i].concat(h.splice(0,e[a])))}}),r}},{key:"isLoaded",value:function(){var t=this.getImage();return!t||!(!t.loaded||!this.ctx)}},{key:"setLinearGradient",value:function(t,e,i,r){this.ctx;this.gradientStyle={x1:t,y1:e,x2:i,y2:r},this.gradientType=1}},{key:"setRadialGradient",value:function(t,e,i,r,h,a){this.ctx;r||(r=t,h=e,a=a),this.gradientStyle={x1:t,y1:e,r1:i,x2:r,y2:h,r2:a},this.gradientType=2}},{key:"_addColorStops",value:function(t){for(var e=this.color,i=0,r=t.length;i<r;i++){var h=t[i],a=h.color;e.addColorStop(h.offset,a)}this.color=e}},{key:"setColorStops",value:function(t){this.colorStops=t;var e=this.gradientStyle;1==this.gradientType?this.color=this.ctx.createLinearGradient(e.x1,e.y1,e.x2,e.y2):2==this.gradientType&&(this.color=this.ctx.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2)),this._addColorStops(t)}},{key:"addColorStops",value:function(t){for(var e=0,i=t.length;e<i;e++)this.colorStops.push(t[e]);this._addColorStops(t)}},{key:"removeColorStopAt",value:function(t){this.colorStops.splice(t,1),this.setColorStops(this.colorStops)}},{key:"getGradientType",value:function(){var t=this.gradientType;return 1==t?"linear":2==t?"radial":"single"}},{key:"_onLoad",value:function(){if(-1!=this.obj)var t=d[this.obj].getSVGDocument(),e=t.getElementsByTagName("path")[0]||t.getElementsByTagName("circle")[0]||t.getElementsByTagName("rect")[0]||t.getElementsByTagName("polygon")[0],i=t.getElementsByTagName("svg")[0];else var i=document.getElementById(this.svgid),t=i,e=t.getElementsByTagName("path")[0]||t.getElementsByTagName("circle")[0]||t.getElementsByTagName("rect")[0]||t.getElementsByTagName("polygon")[0];var r=i.getElementsByTagName("linearGradient")[0]||t.getElementsByTagName("radialGradient")[0];if(r){for(var h=r.getElementsByTagName("stop"),a=[],s=0,o=h.length;s<o;s++){var n=h[s],l={};l.offset=n.getAttribute("offset");var u=n.style.stopColor.toString(),c=n.style.stopOpacity;c&&(u=u.replace("rgb","rgba"),u=u.replace(")",","+c+")")),l.color=u,a.push(l)}if("linearGradient"==r.tagName){var v=Number(r.getAttribute("x1")),f=Number(r.getAttribute("x2")),y=Number(r.getAttribute("y1")),p=Number(r.getAttribute("y2"));this.setLinearGradient(v,y,f,p)}else if("radialGradient"==r.tagName){var g=Number(r.getAttribute("cx")),m=Number(r.getAttribute("cy")),x=Number(r.getAttribute("r"));this.setRadialGradient(g,m,0,g,m,x)}this.setColorStops(a)}if("original"==this.color&&(this.color=e.getAttribute("fill")),"original"==this.strokeColor&&(this.strokeColor,e.getAttribute("stroke")),"path"==e.tagName){var _=e.getAttribute("d");this.path=this.parsePath(_)}else if("circle"==e.tagName){var b=e.getAttribute("r"),k=[];k.push({method:"circle",r:b}),this.path=k}else if("polygon"==e.tagName){var w=e.getAttribute("points");this.path=this.parsePolygon(w)}else if("rect"==e.tagName){var S=e.getAttribute("width"),M=e.getAttribute("height"),k=[];k.push({method:"rect",width:S,height:M}),this.path=k}if(void 0==this.spriteWidth&&(this.spriteWidth=parseInt(i.getAttribute("width")),this.spriteHeight=parseInt(i.getAttribute("height")),!this.spriteWidth)){var C=i.getAttribute("viewBox");if(C){var T=C.split(" ");this.spriteWidth=T[2],this.spriteHeight=T[3]}}this.width||(this.width=this.spriteWidth),this.height||(this.height=this.spriteHeight),this.prepared=!0}},{key:"draw",value:function(){this.path||this._onLoad();var t=this.path,e=this.ctx,i=0,r=0,h=0,a=0,s=0,o=0,n=this.width,l=this.height,u=n/this.spriteWidth,c=l/this.spriteHeight,d=n/2,v=l/2,f=this._x||this.x,y=this._y||this.y,p=this._rot||this.rot;e.globalAlpha=this.alpha,e.globalCompositeOperation=this.drawMode,e.save(),e.translate(f+d,y+v),e.rotate(p),e.translate(-d,-v),e.scale(u,c),e.beginPath();for(var g=0,m=t.length;g<m;g++){var x=this.path[g],_=x.method;if("moveTo"==_||"horizontalTo"==_||"verticalTo"==_||"quadraticCurveTo"==_||"bezierCurveTo"==_||"lineTo"==_||"bezierCurveShortTo"==_||"quadraticCurveShortTo"==_?(h=0,a=0,(x.x||0==x.x)&&(i=x.x),(x.y||0==x.y)&&(r=x.y)):(h=i,a=r,x.x&&(i+=x.x),x.y&&(r+=x.y)),"circle"==_){var b=x.r;e.arc(i+b,r+b,b,0,2*Math.PI,!1)}else"rect"==_?e.fillRect(i,r,x.width,x.height):"moveTo"==_||"moveBy"==_?e.moveTo(i,r):"lineTo"==_||"lineBy"==_?e.lineTo(i,r):"quadraticCurveBy"==_||"quadraticCurveTo"==_?(e.quadraticCurveTo(h+x.cpx,a+x.cpy,i,r),s=2*i-(h+x.cpx),o=2*r-(a+x.cpy)):"bezierCurveTo"==_||"bezierCurveBy"==_?(e.bezierCurveTo(h+x.cpx1,a+x.cpy1,h+x.cpx2,a+x.cpy2,i,r),s=2*i-(h+x.cpx2),o=2*r-(a+x.cpy2)):"horizontalTo"==_||"horizontalBy"==_?e.lineTo(i,r):"verticalTo"==_||"verticalBy"==_?e.lineTo(i,r):"bezierCurveShortBy"==_||"bezierCurveShortTo"==_?(e.bezierCurveTo(s,o,h+x.cpx2,a+x.cpy2,i,r),s=2*i-(h+x.cpx2),o=2*r-(a+x.cpy2)):"quadraticCurveShortBy"!=_&&"quadraticCurveShortTo"!=_||(e.quadraticCurveTo(s,o,i,r),s=2*i-s,o=2*r-o)}this.closeMode&&e.closePath(),e.fillStyle=this.color,e.fill(),e.strokeStyle=this.strokeColor,this.strokeMode&&e.stroke(),e.restore()}},{key:"getNodeByName",value:function(t){for(var e=this.path,i=0,r=e.length;i<r;i++){var h=e[i];if(t==h.name)return h}return-1}}]),e}(k),r.Box=function(t){function e(t,i,r){s(this,e);var a=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i,r));return a._basicConstructor="Shape.Box",a.color=t,a}return a(e,t),l(e,[{key:"draw",value:function(){var t=this.ctx;t.globalAlpha=this.alpha,t.globalCompositeOperation=this.drawMode,t.beginPath(),t.fillStyle=this.color;var e=this._x||this.x,i=this._y||this.y,r=this._rot||this.rot,h=this._width||this.width,a=this._height||this.height,s=e+this.width/2,o=i+this.height/2;t.save(),t.translate(s,o),t.rotate(r),t.translate(-s,-o);var e=this._x||this.x,i=this._y||this.y;t.fillRect(e,i,h,a),t.restore(),t.globalAlpha=1}}]),e}(k),r.Circle=function(t){function e(t,i){s(this,e);var r=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,2*i,2*i));return r._basicConstructor="Shape.Circle",r.color=t,r.collisionShape="circle",r}return a(e,t),l(e,[{key:"draw",value:function(){var t=this.ctx;t.globalAlpha=this.alpha,t.globalCompositeOperation=this.drawMode,t.beginPath(),t.fillStyle=this.color;var e=this._width||this.width,i=e/2,r=this._x||this.x,h=this._y||this.y;t.arc(r+i,h+i,i,0,2*Math.PI,!1),t.fill(),t.globalAlpha=1}}]),e}(k),r.Sprite=function(t){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;s(this,e);var a=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i,r));return a.setImage(t,i,r),a._basicConstructor="Sprite",a.frame=0,a.alpha=1,a}return a(e,t),l(e,[{key:"animate",value:function(t,e,i){var r=_(this,"animate",i);return r.array=t,r.frameRate=e,r.frameIdx=0,this.mover.push(r),this}},{key:"_animate",value:function(t){0==t.time&&(this.frame=t.array[0]),t.time%t.frameRate==0&&(t.frameIdx=(t.frameIdx+1)%t.array.length,this.frame=t.array[t.frameIdx])}},{key:"setSpriteSize",value:function(t,e){this.spriteWidth=t,this.spriteHeight=e}},{key:"setImage",value:function(t,e,i){e&&i&&this.setSpriteSize(e,i);for(var r=u.length,h=0;h<r;h++)u[h].name==t&&(this.img=h)}},{key:"getImage",value:function(){return u[this.img]}},{key:"isLoaded",value:function(){return!(!this.getImage().loaded||!this.ctx)}},{key:"_onLoad",value:function(){var t=this.getImageSize();!this.width&&t.width&&(this.setSpriteSize(t.width,t.height),this.width||(this.setSize(t.width,t.height),this._scaleX&&this.scale(this._scaleX,this._scaleY))),this.prepared=!0}},{key:"getImageSize",value:function(){var t={},e=u[this.img];return t.width=e.width,t.height=e.height,t}},{key:"draw",value:function(){var t=this.ctx;t.globalAlpha=this.alpha,t.globalCompositeOperation=this.drawMode;var e=this.frame,i=u[this.img],r=this.spriteWidth,h=this.spriteHeight,a=this._width||this.width,s=this._height||this.height,o=a/2,n=s/2,l=i.width/r,c=i.height/h,d=a/r,v=s/h,f=e%l*r,y=~~(e/l)%c*h,p=this._x||this.x,g=this._y||this.y,m=this._rot||this.rot;t.save(),t.translate(p+o,g+n),t.rotate(m),t.translate(-o,-n),t.scale(d,v),null!=f&&t.drawImage(i,f,y,r,h,0,0,r,h),t.restore(),t.globalAlpha=1}}]),e}(k)),S=(r.Map=function(t){function e(t,i,r){s(this,e);var a=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,r));return a.drawData,a.hitData,a}return a(e,t),l(e,[{key:"intersect",value:function(t,e){for(var i=this.hitData,r=i[0].length,h=i.length,a=this._width||this.width,s=this._height||this.height,o=this._x||this.x,n=this._y||this.y,l=0;l<h;l++)for(var u=0;u<r;u++)if(1==i[l][u]&&o+u*a<t&&t<o+(u+1)*a&&n+l*s<e&&e<n+(l+1)*s)return!0;return!1}},{key:"draw",value:function(){var t=this.drawData;if(t&&t[0]){var e=t[0].length,i=t.length,r=this._width||this.width,h=this._height||this.height,a=this._x||this.x,s=this._y||this.y,o=0,n=0,l=this.field,c=this.ctx;c.globalAlpha=this.alpha,c.globalCompositeOperation=this.drawMode;for(var d=l.height,v=l.width,f=void 0,y=u[this.img],p=this.spriteWidth,g=this.spriteHeight,m=y.width/p,x=y.height/g,_=this.width/p,b=this.height/g,k=a,w=s;o<i;){for(;n<e;){if((f=t[o][n])>=0&&d>s+h*o&&s+h*(o+1)>0&&v>a+r*n&&a+r*(n+1)>0){var S=f%m*p,M=~~(f/m)%x*g;c.save(),c.translate(k,w),c.scale(_,b),c.drawImage(y,S,M,p,g,0,0,p,g),c.restore()}k+=r,n++}w+=h,k=a,o++,n=0}}}}]),e}(w),r.Text=function(t){function e(t,i,r,a){s(this,e);var o=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o._basicConstructor="Text",o.x=0,o.y=0,o.scaleX=1,o.scaleY=1,o.alpha=1,o.spaceWidth=7,o.font=a?"'"+a+"'":"'Meiryo'",o.size=r?r+"px":"10px",o.string=t||"",o.color=i||"white",o}return a(e,t),l(e,[{key:"setSize",value:function(t){this.size=t+"px"}},{key:"setFont",value:function(t){this.font="'"+t+"'"}},{key:"intersect",value:function(t,e){var i=this._x||this.x,r=this._y||this.y,h=parseInt(this.size)*this.scaleX*this.string.length,a=parseInt(this.size)*this.scaleY,s=t-(i+h/2),o=e-(r+a/2),n=this._rot||this.rot,l=Math.sin(-n),u=Math.cos(-n),c=Math.abs(s*u-o*l),d=Math.abs(s*l+o*u)
;return c<h/2&&d<a/2}},{key:"scale",value:function(t,e){this.scaleX*=t,this.scaleY*=e}},{key:"_scaleBy",value:function(t){0==t.time&&(t.diffWidth=t.scaleX-this.scaleX,t.diffHeight=t.scaleY-this.scaleY),this.scaleX=t.scaleX-t.diffWidth*(1-t.time/t.frame),this.scaleY=t.scaleY-t.diffHeight*(1-t.time/t.frame)}},{key:"draw",value:function(){var t=this._x||this.x,e=this._y||this.y,i=this._rot||this.rot,r=this.scaleX,h=this.scaleY,a=this.ctx,s=this.string.split("<br>"),o=s.length;a.globalAlpha=this.alpha,a.globalCompositeOperation=this.drawMode,a.font=this.size+" "+this.font;var n=1.5*a.measureText("a").width+this.spaceWidth;a.fillStyle=this.color,a.save();var l=parseInt(this.size)*this.scaleX*this.string.length/2,u=parseInt(this.size)*this.scaleY/2;a.translate(t+l,e+u),a.rotate(i),a.translate(-l,-u),a.scale(r,h);for(var c=0;c<o;c++)a.fillText(s[c],0,n),n*=2;a.restore(),a.globalAlpha=1}}]),e}(b),r.Group=function(t){function e(){s(this,e);var t=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.children=[],t.x=0,t.y=0,t._basicConstructor="Group",t}return a(e,t),l(e,[{key:"addChild",value:function(t){t.parent=this,this.children.push(t),this.parent&&(t.ctx=this.parent.ctx,t.field=this.parent.field,this.parent.children.push(t))}},{key:"addChildren",value:function(){for(var t=0,e=arguments.length;t<e;t++)this.addChild(arguments[t])}},{key:"getChild",value:function(t){var e=this.getChildren(t),i=e[0];return i||(i=null),i}},{key:"getChildren",value:function(t){for(var e=[],i=this.children,r=0,h=i.length;r<h;r++){var a=!0;for(var s in t)if("$not"==s)for(var o in t.$not)t.$not[o]==i[r][o]&&(a=!1);else t[s]!=i[r][s]&&(a=!1);1==a&&e.push(i[r])}return e}},{key:"removeChild",value:function(t){this.getChild(t).remove()}},{key:"removeChildren",value:function(t){for(var e=this.getChildren(t),i=0,r=e.length;i<r;i++)e[i].remove()}},{key:"draw",value:function(){}}]),e}(k)),M=r.Scene=function(t){function e(){s(this,e);var t=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._basicConstructor="Scene",t._remove=!1,t}return a(e,t),l(e,[{key:"addChild",value:function(t){if(t.parent=this,this.ctx&&this.field&&(t.ctx=this.ctx,t.field=this.field),this.children.push(t),"Group"==t._basicConstructor||"Layer"==t._basicConstructor)for(var e=t.children,i=0,r=e.length;i<r;i++){var h=e[i];h.ctx||(h.ctx=this.ctx,h.field=this.field,this.children.push(h))}}},{key:"setImage",value:function(t){this.image=t}},{key:"setColor",value:function(t){this.color=t}},{key:"_enterFrame",value:function(t){this.enterFrame&&this.enterFrame();for(var e=this.children,i=0,r=e.length;i<r;i++){var h=e[i];h._remove?(e.splice(i,1),h=null,i--,r--):("Sprite"!=h._basicConstructor&&"Map"!=h._basicConstructor&&"Shape"!=h._basicConstructor||h.isLoaded()&&!h.prepared&&(h._onLoad(),h.onLoad&&h.onLoad()),h.useEvent&&h.useEvent(),h._enterFrame&&h._enterFrame(),h.enterFrame&&h.enterFrame(),h.tween&&h.tween(),h.visible&&h.draw())}}}]),e}(S);r.Layer=function(t){function e(){s(this,e);var t=h(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.rot=0,t._basicConstructor="Layer",t.firstWidth=100,t.firstHeight=100,t.height=100,t.width=100,t.scaleX=1,t.scaleY=1,t}return a(e,t),l(e,[{key:"fitToChildren",value:function(){var t=this.children,e=this.x,i=this.y;this.x=null,this.y=null,this.width=0,this.height=0;for(var r=0,h=t.length;r<h;r++){var a=t[r],s=a._x||a.x,o=a._y||a.y,n=a._width||a.width,l=a._height||a.height,u=s+n/2,c=o+l/2,d=a._rot||a.rot;if(d%=2*Math.PI,d<0&&(d+=2*Math.PI),d>=0&&d<=Math.PI/2)var v=Math.cos(d)*(s-u)-Math.sin(d)*(o+l-c)+u,f=Math.cos(d)*(s+n-u)-Math.sin(d)*(o-c)+u,y=Math.sin(d)*(s-u)+Math.cos(d)*(o-c)+c,p=Math.sin(d)*(s+n-u)+Math.cos(d)*(o+l-c)+c;else if(Math.PI/2<d&&d<=Math.PI)var v=Math.cos(d)*(s+n-u)-Math.sin(d)*(o+l-c)+u,f=Math.cos(d)*(s-u)-Math.sin(d)*(o-c)+u,y=Math.sin(d)*(s-u)+Math.cos(d)*(o+l-c)+c,p=Math.sin(d)*(s+n-u)+Math.cos(d)*(o-c)+c;else if(Math.PI<d&&d<=1.5*Math.PI)var v=Math.cos(d)*(s+n-u)-Math.sin(d)*(o-c)+u,f=Math.cos(d)*(s-u)-Math.sin(d)*(o+l-c)+u,y=Math.sin(d)*(s+n-u)+Math.cos(d)*(o+l-c)+c,p=Math.sin(d)*(s-u)+Math.cos(d)*(o-c)+c;else if(1.5*Math.PI<d&&d<=2*Math.PI)var v=Math.cos(d)*(s-u)-Math.sin(d)*(o-c)+u,f=Math.cos(d)*(s+n-u)-Math.sin(d)*(o+l-c)+u,y=Math.sin(d)*(s+n-u)+Math.cos(d)*(o-c)+c,p=Math.sin(d)*(s-u)+Math.cos(d)*(o+l-c)+c;(!this.x||this.x>v)&&(this.x=v),(!this.y||this.y>y)&&(this.y=y),this.width<f&&(this.width=f),this.height<p&&(this.height=p)}this.width-=this.x,this.height-=this.y,this.firstWidth=this.width,this.firstHeight=this.height;for(var g=0,m=t.length;g<m;g++){var a=t[g];a._x?(a.x+=e-this.x,a.y+=i-this.y):(a._x=a.x,a._y=a.y,a.x-=this.x,a.y-=this.y)}return this}},{key:"releaseChild",value:function(t){var e=this.parent;t.x=t._x,t.y=t._y,t.width=t._width,t.height=t._height,t.rot=t._rot,t._x=null,t._y=null,t._width=null,t._height=null,t._rot=null,t.grouped=!1,t._leave=!1,t.parent=e}},{key:"releaseAllChildren",value:function(){for(var t=this.children,e=0,i=t.length;e<i;e++){var r=t[e];this.releaseChild(r)}return this.children=[],this._remove=!0,this}},{key:"removeChildrenByProperty",value:function(t){for(var e=this.getChildren(t),i=0,r=e.length;i<r;i++)e[i].remove();return this}},{key:"removeAllChildren",value:function(){for(var t=this.children,e=(this.parent,0),i=t.length;e<i;e++)t[e].remove();return this}},{key:"_setAbsPos",value:function(t){var e=this.width/2,i=this.height/2,r=this.rot;t.Cx=this.scaleX*t.x+t._width/2,t.Cy=this.scaleY*t.y+t._height/2,t.startRot=!0;var h=Math.cos(r)*(t.Cx-e)-Math.sin(r)*(t.Cy-i)+e,a=Math.sin(r)*(t.Cx-e)+Math.cos(r)*(t.Cy-i)+i;t._x=h-t._width/2,t._y=a-t._height/2,t._x+=this.x,t._y+=this.y}},{key:"draw",value:function(){var t=this.children;this.scaleX=this.width/this.firstWidth,this.scaleY=this.height/this.firstHeight;for(var e=0,i=t.length;e<i;e++){var r=t[e];r._leave||r._remove?(t.splice(e,1),this.releaseChild(r),e--,i--):(r._rot=r.rot+this.rot,r._width=this.scaleX*r.width,r._height=this.scaleY*r.height,this._setAbsPos(r))}}}]),e}(S);r.default=x},{}]},{},[1])(1)});