!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Atlas=e():t.Atlas=e()}(window,(function(){return function(t){var e={};function i(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(o,r,function(e){return t[e]}.bind(null,r));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="build",i(i.s=6)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r=[],n=[],s=[],h=0;e.addImage=function(t){h++,r.push(t)},e.addSound=function(t){h++,n.push(t)},e.addSvg=function(t){h++,s.push(t)},e.finishLoad=function(){h--},e.isLoaded=function(){return 0===h},e.getImageAssets=function(){return r},e.getSoundAssets=function(){return n},e.getSvgAssets=function(){return s},e.isMobile=(o=navigator.userAgent).indexOf("iPhone")>0&&-1==o.indexOf("iPad")||o.indexOf("iPod")>0||o.indexOf("Android")>0,e.orientation=window.matchMedia("(orientation: portrait)").matches?"portrait":"landscape",e.setKeyState=function(t,e){var i=e.which;switch(i){case 13:t.enter=!0;break;case 16:t.shift=!0;break;case 32:t.space=!0;break;case 39:t.right=!0;break;case 37:t.left=!0;break;case 38:t.up=!0;break;case 40:t.down=!0;break;case 8:t.backspace=!0}e.metaKey&&(t.command=!0);for(var o=0;o<26;o++)if(o+65==i){t[String.fromCharCode(o+97)]=!0;break}},e.clearKeyState=function(t){t.enter=!1,t.command=!1,t.shift=!1,t.space=!1,t.right=!1,t.left=!1,t.up=!1,t.down=!1,t.backspace=!1;for(var e=0;e<26;e++)t[String.fromCharCode(e+97)]=!1};var a,c=(a={},e.clearKeyState(a),a);e.getKeydown=function(){return c},e.Tween=function(t,e,i){var o=t.mover,r=o[o.length-1],n={};return r&&r.and&&(n=r),n.time=0,i&&(n.frame=i),n.loop=!1,n.and=!1,n[e]=!0,n}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=function(){function t(){this.isMobile=o.isMobile,this.orientation=o.orientation,this.mover=[],this.rot=0,this.moverIndex=0,this.visible=!0,this.eventEnable=!0,this.drawMode="source-over",this.eventListener={touchStart:!1,touchMove:!1,touchEnd:!1,keyUp:!1,keyDown:!1,multiTouchStart:!1,multiTouchMove:!1,multiTouchEnd:!1,orientationChange:!1}}return t.prototype.multiTouchStart=function(t){},t.prototype.multiTouchMove=function(t){},t.prototype.multiTouchEnd=function(t){},t.prototype.touchStart=function(t){},t.prototype.touchMove=function(t){},t.prototype.touchEnd=function(t){},t.prototype.keyUp=function(t){},t.prototype.keyDown=function(t){},t.prototype.enterFrame=function(){},t.prototype.onSceneRemoved=function(){},t.prototype.onScenePushed=function(){},t.prototype.onLoad=function(){},t.prototype.isLoaded=function(){return!0},t.prototype._enterFrame=function(){},t.prototype._onLoad=function(){},t.prototype.draw=function(){},t.prototype.tween=function(){var t=this.mover,e=t.length;if(this.moverIndex<e){var i=t[this.moverIndex];i.animate&&this._animate(i),i.moveTo&&this._moveTo(i),i.moveBy&&this._moveBy(i),i.rotateBy&&this._rotateBy(i),i.scaleBy&&this._scaleBy(i),i.then&&this._then(i),i.time++,i.time>=i.frame&&(this.moverIndex++,this.moverIndex==e&&(i.loop?this._refresh():this.stop()))}},t.prototype._animate=function(t){},t.prototype._scaleBy=function(t){},t.prototype._refresh=function(){this.moverIndex=0;for(var t=this.mover,e=0,i=t.length;e<i;e++){var o=t[e];o.time&&(o.time=0)}},t.prototype.isQueEmpty=function(){return!this.mover.length},t.prototype.moveTo=function(t,e,i){var r=o.Tween(this,"moveTo",i);return r.toX=t,r.toY=e,this.mover.push(r),this},t.prototype._moveTo=function(t){0===t.time&&(t.diffX=t.toX-this.x,t.diffY=t.toY-this.y),this.x=t.toX-t.diffX*(1-t.time/t.frame),this.y=t.toY-t.diffY*(1-t.time/t.frame)},t.prototype.moveBy=function(t,e,i){var r=o.Tween(this,"moveBy",i);return r.diffX=t,r.diffY=e,this.mover.push(r),this},t.prototype._moveBy=function(t){0===t.time&&(t.toX=this.x+t.diffX,t.toY=this.y+t.diffY),this.x=t.toX-t.diffX*(1-t.time/t.frame),this.y=t.toY-t.diffY*(1-t.time/t.frame)},t.prototype.delay=function(t){var e=o.Tween(this,"delay",t);return this.mover.push(e),this},t.prototype.and=function(){var t=this.mover,e=t[t.length-1];return e&&(e.and=!0),this},t.prototype.stop=function(){return this.mover=[],this.moverIndex=0,this},t.prototype.loop=function(){return this.mover[this.mover.length-1].loop=!0,this},t.prototype.rotateBy=function(t,e){var i=o.Tween(this,"rotateBy",e);return this.mover.push(i),i.diffAngle=t,this},t.prototype._rotateBy=function(t){0===t.time&&(t.toAngle=this.rot+t.diffAngle),this.rot=t.toAngle-t.diffAngle*(1-t.time/t.frame)},t.prototype.then=function(t,e){var i=o.Tween(this,"then",e);return i.exec=t,this.mover.push(i),this},t.prototype._then=function(t){t.exec.call(this)},t.prototype.scaleBy=function(t,e,i){var r=o.Tween(this,"scaleBy",i);return r.scaleX=t,r.scaleY=e,this.mover.push(r),this},t.prototype.setPosition=function(t,e){return this.x=t,this.y=e,this},t.prototype.saveData=function(t){var e={};for(var i in this)"function"!=typeof this[i]&&(e[i]=this[i]);localStorage.setItem(t,JSON.stringify(e))},t.prototype.getData=function(t){var e=JSON.parse(localStorage.getItem(t));for(var i in e)this[i]=e[i]},t.prototype.getTouchPosition=function(t,e){e&&t.touches[e]||(e=0);var i=this.field,r=parseInt(""+i.width)/parseInt(i.style.width),n=parseInt(""+i.height)/parseInt(i.style.height),s={},h=i.getBoundingClientRect(),a=parseInt(""+h.left),c=parseInt(""+h.top);isNaN(a)&&(a=0),isNaN(c)&&(c=0);var u=document.documentElement.scrollLeft||document.body.scrollLeft,p=document.documentElement.scrollTop||document.body.scrollTop;return t?!o.isMobile||o.isMobile&&t.touches[e]?(s.x=(o.isMobile?t.touches[e].pageX:t.pageX)-a-u,s.y=(o.isMobile?t.touches[e].pageY:t.pageY)-c-p):(s.x=-1,s.y=-1):(s.x=event.x-a,s.y=event.y-c),s.x=Math.floor(s.x*r),s.y=Math.floor(s.y*n),s},t.prototype.getMultiTouchPosition=function(t){for(var e=t.touches.length,i=[],o=0;o<e;o++)i[o]=this.getTouchPosition(t,o);return i},t.prototype.handleEvent=function(t){if(this.eventEnable){t.preventDefault();var e=this.getTouchPosition(t);t.touches?e.touchCount=t.touches.length:e.touchCount=1,e.event=t;var i=t.type,r=o.getKeydown();switch(i){case"touchstart":this.multiTouchStart&&t.touches.length>1?this.multiTouchStart(this.getMultiTouchPosition(t)):this.touchStart&&this.touchStart(e);break;case"mousedown":this.touchStart&&this.touchStart(e);break;case"touchmove":this.multiTouchMove&&t.touches.length>1?this.multiTouchMove(this.getMultiTouchPosition(t)):this.touchMove&&this.touchMove(e);break;case"mousemove":this.touchMove&&this.touchMove(e);break;case"touchend":this.multiTouchEnd&&t.touches.length>1?this.multiTouchEnd(this.getMultiTouchPosition(t)):this.touchEnd&&this.touchEnd(e);break;case"mouseup":this.touchEnd&&this.touchEnd();break;case"keydown":this.keyDown&&this.keyDown(r);break;case"keyup":this.keyUp&&this.keyUp()}}},t.prototype.useEvent=function(){var t=this.field,e=this.eventListener;this.touchStart&&!1===e.touchStart&&(o.isMobile?t.addEventListener("touchstart",this,!1):t.addEventListener("mousedown",this,!1),e.touchStart=!0),this.touchMove&&!1===e.touchMove&&(o.isMobile?t.addEventListener("touchmove",this,!1):t.addEventListener("mousemove",this,!1),e.touchMove=!0),this.touchEnd&&!1===e.touchEnd&&(o.isMobile?t.addEventListener("touchend",this,!1):t.addEventListener("mouseup",this,!1),e.touchEnd=!0),this.multiTouchStart&&!1===e.multiTouchStart&&(e.touchStart||(o.isMobile?t.addEventListener("touchstart",this,!1):t.addEventListener("mousedown",this,!1)),e.touchStart=!0),this.multiTouchMove&&!1===e.multiTouchMove&&(e.touchMove||(o.isMobile?t.addEventListener("touchmove",this,!1):t.addEventListener("mousemove",this,!1)),e.touchMove=!0),this.multiTouchEnd&&!1===e.multiTouchEnd&&(e.touchEnd||(o.isMobile?t.addEventListener("touchend",this,!1):t.addEventListener("mouseup",this,!1)),e.touchEnd=!0),this.keyUp&&!1===e.keyUp&&(t.addEventListener("keyup",this,!1),e.keyUp=!0),this.keyDown&&!1===e.keyDown&&(t.addEventListener("keydown",this,!1),e.keyDown=!0)},t.prototype.remove=function(){this._remove=!0},t.prototype.leave=function(){this._leave=!0},t.prototype.getRand=function(t,e){return~~(Math.random()*(e-t+1))+t},t.prototype.getRandText=function(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=i.length,r=0;r<t;r++)e+=i.charAt(Math.floor(this.getRand(0,o)));return e},t.prototype.rgbToHex=function(t,e,i){return"#"+(16777216+(i|e<<8|t<<16)).toString(16).slice(1)},t.prototype.hexToRgb=function(t,e){if("string"!=typeof this.color)return null;var i=t||this.color,o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return e?o?"rgba("+parseInt(o[1],16)+","+parseInt(o[2],16)+","+parseInt(o[3],16)+","+e+")":null:o?"rgb("+parseInt(o[1],16)+","+parseInt(o[2],16)+","+parseInt(o[3],16)+")":null},t.prototype.hsvToHex=function(t,e,i){var o,r,n,s,h,a=0,c=0,u=0;switch(r=Math.floor(t/60)%6,o=t/60-Math.floor(t/60),n=Math.round(i*(1-e/255)),s=Math.round(i*(1-e/255*o)),h=Math.round(i*(1-e/255*(1-o))),r){case 0:a=i,c=h,u=n;break;case 1:a=s,c=i,u=n;break;case 2:a=n,c=i,u=h;break;case 3:a=n,c=s,u=i;break;case 4:a=h,c=n,u=i;break;case 5:a=i,c=n,u=s}return"#"+(a=a<=15?"0"+a.toString(16):a.toString(16))+(c=c<=15?"0"+c.toString(16):c.toString(16))+(u=u<=15?"0"+u.toString(16):u.toString(16))},t.prototype.rgbToHsv=function(t,e,i){t/=255,e/=255,i/=255;var o,r,n,s,h=0,a=0,c=(s=Math.max(t,e,i))-Math.min(t,e,i);return 0==c?h=a=0:(a=c/s,o=(s-t)/6/c+.5,r=(s-e)/6/c+.5,n=(s-i)/6/c+.5,t===s?h=n-r:e===s?h=1/3+o-n:i===s&&(h=2/3+r-o),h<0?h+=1:h>1&&(h-=1)),"hsv("+Math.round(360*h)+","+Math.round(100*a)+","+Math.round(100*s)+")"},t.prototype.hexToHsv=function(t){return this.hexToRgb(t)},t.prototype.getObjFromRgb=function(t){var e=/rgb\((.*?),(.*?),(.*?)\)/.exec(t);return{r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])}},t.prototype.getObjFromHsv=function(t){var e=/hsv\((.*?),(.*?),(.*?)\)/.exec(t);return{h:parseInt(e[1]),s:parseInt(e[2]),v:parseInt(e[3])}},t.prototype.getSound=function(t){for(var e=o.getSoundAssets(),i=0,r=e.length;i<r;i++)t==e[i].dataset.name&&(this.sound=new Audio(e[i].src))},t.prototype.soundClonePlay=function(){var t=this.sound;t&&new Audio(t.src).play()},t.prototype.soundLoopPlay=function(){var t=this.sound;t&&(t.loop||t.addEventListener("ended",(function(){this.currentTime=0,this.play()}),!1),t.loop=!0,t.play())},t.prototype.soundReplay=function(){var t=this.sound;t&&(t.load(),t.play())},t.prototype.soundStop=function(){var t=this.sound;t.paused?t.load():(t.pause(),t.currentTime=0)},t.prototype.soundPlay=function(){var t=this.sound;t&&t.play()},t.prototype.soundPause=function(){var t=this.sound;t&&t.pause()},t.prototype.soundGetCount=function(){var t=this.sound;if(t)return t.currentTime},t.prototype.soundSetCount=function(t){var e=this.sound;e&&(e.currentTime=t)},t.prototype.soundGetVolume=function(){var t=this.sound;if(t)return t.volume},t.prototype.soundSetVolume=function(t){var e=this.sound;e&&(e.volume=t)},t.prototype.soundGetAlltime=function(){var t=this.sound;if(t)return t.duration},t.prototype.soundIsPlaying=function(){var t=this.sound;if(t)return!t.paused},t.prototype.getExtention=function(t){var e="";if(!t)return e;var i=t.split("."),o=i.length;return 0===o?e:e=i[o-1]},t}();e.Util=r},function(t,e,i){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var o=t.call(this)||this;return o.x=0,o.y=0,o._remove=!1,o.width=e,o.height=i,o.collisionShape="box",o.prepared=!1,o.alpha=1,o}return r(e,t),e.prototype._scaleBy=function(t){0===t.time&&(t.toWidth=this.width*t.scaleX,t.toHeight=this.height*t.scaleY,t.diffWidth=t.toWidth-this.width,t.diffHeight=t.toHeight-this.height),this.width=t.toWidth-t.diffWidth*(1-t.time/t.frame),this.height=t.toHeight-t.diffHeight*(1-t.time/t.frame)},e.prototype.intersect=function(t,e){var i=this._x||this.x,o=this._y||this.y,r=this._width||this.width,n=this._height||this.height,s=this._rot||this.rot;if("box"==this.collisionShape){var h=t-(i+r/2),a=e-(o+n/2),c=Math.sin(-s),u=Math.cos(-s),p=Math.abs(h*u-a*c),l=Math.abs(h*c+a*u);return p<r/2&&l<n/2}if("circle"==this.collisionShape){var d=r/2;h=t-(i+d),a=e-(o+d);return Math.sqrt(h*h+a*a)<d}return!1},e.prototype.hitTest=function(t){var e=this._x||this.x,i=this._y||this.y,o=this._width||this.width,r=this._height||this.height,n=e+o/2,s=i+r/2,h=t._x||t.x,a=t._y||t.y,c=t._width||t.width,u=t._height||t.height,p=t._rot||t.rot;if("box"!=this.collisionShape)return"circle"==this.collisionShape&&this.within(t,o/2);if("circle"==t.collisionShape)return t.within(this,c/2);if(0!==p&&p!=Math.PI&&"box"==t.collisionShape){var l=h+c/2,d=a+u/2,f=-p;e=(n=Math.cos(f)*(n-l)-Math.sin(f)*(s-d)+l)-o/2,i=(s=Math.sin(f)*(n-l)+Math.cos(f)*(s-d)+d)-r/2}return e<h+c&&h<e+o&&i<a+u&&a<i+r},e.prototype.within=function(t,e){var i,o,r,n,s=this._x||this.x,h=this._y||this.y,a=this._width||this.width,c=this._height||this.height,u=(this._rot||this.rot,t._x||t.x),p=t._y||t.y,l=t._width||t.width,d=t._height||t.height,f=t._rot||t.rot;if("box"==this.collisionShape)var y=s+a/2,v=h+c/2;else{if("circle"!=this.collisionShape)return!1;var g=a/2;y=s+g,v=h+g}if("box"==t.collisionShape){var m=u+l/2,_=p+d/2,x=-f,b=Math.cos(x)*(y-m)-Math.sin(x)*(v-_)+m,w=Math.sin(x)*(y-m)+Math.cos(x)*(v-_)+_;r=b<u?u:b>u+l?u+l:b,n=w<p?p:w>p+d?p+d:w,i=Math.abs(b-r),o=Math.abs(w-n)}else{if("circle"!=t.collisionShape)return!1;var M=l/2;r=u+M,n=p+M,i=Math.abs(y-r),o=Math.abs(v-n),e+=M}return Math.sqrt(i*i+o*o)<e},e.prototype.scale=function(t,e){return this.width?(this.width*=t,this.height*=e):(this._scaleX=t,this._scaleY=e),this},e.prototype.setSize=function(t,e){this.width=t,this.height=e},e}(i(1).Util);e.Thing=n},function(t,e,i){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){var e=t.call(this)||this;return e.children=[],e.x=0,e.y=0,e._basicConstructor="Group",e}return r(e,t),e.prototype.addChild=function(t){t.parent=this,this.children.push(t),this.parent&&(t.ctx=this.parent.ctx,t.field=this.parent.field,this.parent.children.push(t))},e.prototype.addChildren=function(){for(var t=0,e=arguments.length;t<e;t++)this.addChild(arguments[t])},e.prototype.getChild=function(t){var e=this.getChildren(t)[0];if(e)return e},e.prototype.getChildren=function(t){for(var e=[],i=this.children,o=0,r=i.length;o<r;o++){var n=!0;for(var s in t)if("$not"==s)for(var h in t.$not)t.$not[h]==i[o][h]&&(n=!1);else t[s]!=i[o][s]&&(n=!1);1==n&&e.push(i[o])}return e},e.prototype.removeChild=function(t){var e=this.getChild(t);e&&e.remove()},e.prototype.removeChildren=function(t){for(var e=this.getChildren(t),i=0,o=e.length;i<o;i++)e[i].remove()},e.prototype.draw=function(){},e}(i(2).Thing);e.Group=n},function(t,e,i){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){var e=t.call(this)||this;return e._basicConstructor="Scene",e._remove=!1,e}return r(e,t),e.prototype.addChild=function(t){if(t.parent=this,this.ctx&&this.field&&(t.ctx=this.ctx,t.field=this.field),this.children.push(t),"Group"==t._basicConstructor||"Layer"==t._basicConstructor)for(var e=t.children,i=0,o=e.length;i<o;i++){var r=e[i];r.ctx||(r.ctx=this.ctx,r.field=this.field,this.children.push(r))}},e.prototype.setImage=function(t){this.image=t},e.prototype.setColor=function(t){this.color=t},e.prototype._enterFrame=function(){this.enterFrame&&this.enterFrame();for(var t=this.children,e=0,i=t.length;e<i;e++){var o=t[e];o._remove?(t.splice(e,1),e--,i--):("Sprite"!=o._basicConstructor&&"Map"!=o._basicConstructor&&"Shape"!=o._basicConstructor||o.isLoaded()&&!o.prepared&&(o._onLoad(),o.onLoad&&o.onLoad()),o.useEvent&&o.useEvent(),o._enterFrame&&o._enterFrame(),o.enterFrame&&o.enterFrame(),o.tween&&o.tween(),o.visible&&o.draw())}},e}(i(3).Group);e.Scene=n},function(t,e,i){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=i(2),s=i(0),h=function(t){function e(e,i,o){var r=t.call(this,i,o)||this;return r.setImage(e,i,o),r._basicConstructor="Sprite",r.frame=0,r.alpha=1,r}return r(e,t),e.prototype.animate=function(t,e,i){var o=s.Tween(this,"animate",i);return o.array=t,o.frameRate=e,o.frameIdx=0,this.mover.push(o),this},e.prototype._animate=function(t){0==t.time&&(this.frame=t.array[0]),t.time%t.frameRate==0&&(t.frameIdx=(t.frameIdx+1)%t.array.length,this.frame=t.array[t.frameIdx])},e.prototype.setSpriteSize=function(t,e){this.spriteWidth=t,this.spriteHeight=e},e.prototype.setImage=function(t,e,i){e&&i&&this.setSpriteSize(e,i);for(var o=s.getImageAssets(),r=o.length,n=0;n<r;n++)o[n].name==t&&(this.img=n)},e.prototype.getImage=function(){return s.getImageAssets()[this.img]},e.prototype.isLoaded=function(){return!(!this.getImage().dataset.loaded||!this.ctx)},e.prototype._onLoad=function(){var t=this.getImageSize();!this.width&&t.width&&(this.setSpriteSize(t.width,t.height),this.width||(this.setSize(t.width,t.height),this._scaleX&&this.scale(this._scaleX,this._scaleY))),this.prepared=!0},e.prototype.getImageSize=function(){var t={},e=s.getImageAssets()[this.img];return t.width=e.width,t.height=e.height,t},e.prototype.draw=function(){var t=s.getImageAssets(),e=this.ctx;e.globalAlpha=this.alpha,e.globalCompositeOperation=this.drawMode;var i=this.frame,o=t[this.img],r=this.spriteWidth,n=this.spriteHeight,h=this._width||this.width,a=this._height||this.height,c=h/2,u=a/2,p=o.width/r,l=h/r,d=a/n,f=i%p*r,y=~~(i/p)%(o.height/n)*n,v=this._x||this.x,g=this._y||this.y,m=this._rot||this.rot;e.save(),e.translate(v+c,g+u),e.rotate(m),e.translate(-c,-u),e.scale(l,d),null!=f&&e.drawImage(o,f,y,r,n,0,0,r,n),e.restore(),e.globalAlpha=1},e}(n.Thing);e.Sprite=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(7);e.App=o.App;var r=i(3);e.Group=r.Group;var n=i(8);e.Layer=n.Layer;var s=i(9);e.Map=s.Map;var h=i(4);e.Scene=h.Scene;var a=i(10);e.Shape=a.Shape,e.Box=a.Box,e.Circle=a.Circle;var c=i(5);e.Sprite=c.Sprite;var u=i(11);e.Text=u.Text;var p=i(2);e.Thing=p.Thing;var l=i(1);e.Util=l.Util},function(t,e,i){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),s=i(4),h=i(0),a=function(t){function e(e){var i=t.call(this)||this;i.assetPath="",i._basicConstructor="App";var o,r=document.createElement("style");if(r.media="screen",r.type="text/css",document.getElementsByTagName("head")[0].appendChild(r),e)o=document.getElementById(e);else{o=document.createElement("canvas");var n=document.getElementsByTagName("body").item(0);n&&n.appendChild(o)}return o.width=320,o.height=480,o.style.top="0px",o.style.left="0px",o.tabIndex="1",document.body.style.margin="0em",h.isMobile?(o.style.width=window.innerWidth+"px",o.style.height=window.innerHeight+"px",o.addEventListener("touchstart",(function(){-1!=this.tabIndex&&this.focus()}))):(o.style.width="480px",o.style.height="620px",o.addEventListener("mousedown",(function(){-1!=this.tabIndex&&this.focus()})),o.addEventListener("keyup",(function(){var t=h.getKeydown();h.clearKeyState(t)}),!1),o.addEventListener("keydown",(function(t){var e=h.getKeydown();h.setKeyState(e,t)}))),i._css=r,i.field=o,i.ctx=o.getContext("2d"),i.fps=30,i.scene=new s.Scene,i.scene.ctx=i.ctx,i.scene.field=i.field,i.scene.parent=i,i}return r(e,t),e.prototype.clearLockMode=function(){this.field.tabIndex=-1},e.prototype.setLockMode=function(){this.field.tabIndex=1},e.prototype.getCanvasURL=function(){return this.field.toDataURL()},e.prototype.getCanvasImage=function(){var t=this.field.toDataURL();window.open(t,"_blank")},e.prototype.getChild=function(t){return this.scene.getChild(t)},e.prototype.getChildren=function(t){return this.scene.getChildren(t)},e.prototype.colorToAlpha=function(t,e){for(var i=new Image,o=h.getImageAssets(),r=0,n=o.length;r<n;r++)o[r].name==t&&((i=o[r]).dataset.hex=e,i.dataset.index=""+r);i.addEventListener("load",(function(){var t=document.createElement("canvas"),e=t.getContext("2d"),r=i.width,n=i.height;if(i.dataset.hex){var s=i.dataset.hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,i,o){return e+e+i+i+o+o})),h=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s),a=h?{r:parseInt(h[1],16),g:parseInt(h[2],16),b:parseInt(h[3],16)}:null;e.drawImage(i,0,0);for(var c=e.getImageData(0,0,r,n),u=c.data,p=0;p<n;p++)for(var l=0;l<r;l++){var d=p*(4*r)+4*l;a&&u[d]==a.r&&u[d+1]==a.g&&u[d+2]==a.b&&(u[d+3]=0)}e.putImageData(c,0,0);var f=new Image;f.src=t.toDataURL(),o[parseInt(i.dataset.index)]=f}}))},e.prototype.addChild=function(t){t.ctx=this.ctx,t.field=this.field,this.scene.addChild(t)},e.prototype.addChildren=function(){for(var t=0,e=arguments.length;t<e;t++)this.addChild(arguments[t])},e.prototype.centerize=function(){var t=this.field.style;t.marginTop=-parseInt(t.height)/2+"px",t.marginLeft=-parseInt(t.width)/2+"px",t.top="50%",t.left="50%",t.position="absolute"},e.prototype.fitWindow=function(){this.setSize(window.innerWidth,window.innerHeight);var t=this;window.onresize=function(){t.setSize(window.innerWidth,window.innerHeight)}},e.prototype.setQuality=function(t,e){var i=this.field;i.width=t,i.height=e},e.prototype.setSize=function(t,e){var i=this.field.style;i.width=t+"px",i.height=e+"px"},e.prototype.getSize=function(){var t={};return t.width=parseInt(this.field.style.width),t.height=parseInt(this.field.style.height),t},e.prototype.getQuality=function(){var t={};return t.width=this.field.width,t.height=this.field.height,t},e.prototype.loadingScene=function(t){this.preScene=t,this.preScene.parent=this},e.prototype._preLoadEnterFrame=function(){var t=this.field;if(this.useEvent(),this.ctx.clearRect(0,0,t.width,t.height),h.isLoaded())this.preScene&&this.preScene._enterFrame();else{this.onLoad&&this.onLoad();for(var e=this.scene.children,i=0,o=e.length;i<o;i++){var r=e[i];r._onLoad&&r._onLoad(),r.onLoad&&r.onLoad()}clearInterval(this.preLoadInterval);var n=this;setInterval((function(){n._enterFrame()}),1e3/this.fps)}},e.prototype._enterFrame=function(){var t=this.field;this.ctx.clearRect(0,0,t.width,t.height),this.useEvent(),this.enterFrame&&this.enterFrame(),this.scene._enterFrame()},e.prototype.pushScene=function(t){for(var e=this.ctx,i=this.field,o=this.scene.children,r=0,n=o.length;r<n;r++){var s=o[r];s.eventEnable=!1,s.onSceneRemoved&&s.onSceneRemoved()}for(r=0,n=(o=t.children).length;r<n;r++){var h=o[r];h.ctx=e,h.field=i,h.eventEnable=!0,h.onScenePushed&&h.onScenePushed()}t.parent=this,t.ctx=e,t.field=i;var a=this.field.style;a.background="",a.backgroundColor="white",t.color&&this.setColor(t.color),t.image&&this.setImage(t.image),this.scene=t},e.prototype.setColor=function(t){var e=this.field.style;e.background="","string"==typeof t&&(e.backgroundColor=t)},e.prototype.setImage=function(t){var e=this.field.style;e.background="url("+t+") no-repeat center",e.backgroundSize="cover"},e.prototype.start=function(){var t=this.field,e=this;this.ctx.clearRect(0,0,t.width,t.height),this.preLoadInterval=setInterval((function(){e._preLoadEnterFrame()}),1e3/this.fps)},e.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=function(e,i){var r=t[e],n=r,s=r;r instanceof Array&&(n=r[0],s=r[1]);var a=void 0;if(n.match("data:image/png")?a="png":(o.assetPath&&(n=""+o.assetPath+n),a=o.getExtention(n)),"wav"==a||"mp3"==a||"ogg"==a){var c=new Audio(n);c.name=s,c.addEventListener("canplaythrough",(function(){h.finishLoad(),console.log(c.src+" is loaded")})),h.addSound(c)}else if("TTF"==a||"ttf"==a){var u=o._css,p=document.createTextNode("@font-face{font-family:'"+s+"';src: url('"+n+"') format('truetype');}");u.styleSheet?u.styleSheet.cssText=p:u.appendChild(p)}else if("svg"==a){var l=document.createElement("object");l.addEventListener("load",(function(){h.finishLoad(),l.style.display="none",l.dataset.loaded="true",console.log(l.data+" is loaded")})),l.data=n,l.name=s,document.body.appendChild(l),h.addSvg(l)}else if("png"==a||"gif"==a||"jpeg"==a||"jpg"==a){var d=new Image;d.addEventListener("load",(function(){h.finishLoad(),d.dataset.loaded="true",console.log(d.src+" is loaded")})),d.src=n,d.name=s,h.addImage(d)}},o=this,r=0,n=t.length;r<n;r++)i(r,n)},e}(n.Util);e.App=a},function(t,e,i){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){var e=t.call(this)||this;return e.rot=0,e._basicConstructor="Layer",e.firstWidth=100,e.firstHeight=100,e.height=100,e.width=100,e.scaleX=1,e.scaleY=1,e}return r(e,t),e.prototype.fitToChildren=function(){var t=this.children,e=this.x,i=this.y;this.x=1/0,this.y=1/0,this.width=0,this.height=0;for(var o=0,r=t.length;o<r;o++){var n=(v=t[o])._x||v.x,s=v._y||v.y,h=v._width||v.width,a=v._height||v.height,c=n+h/2,u=s+a/2,p=v._rot||v.rot,l=1/0,d=1/0,f=1/0,y=1/0;(p%=2*Math.PI)<0&&(p+=2*Math.PI),p>=0&&p<=Math.PI/2?(l=Math.cos(p)*(n-c)-Math.sin(p)*(s+a-u)+c,d=Math.cos(p)*(n+h-c)-Math.sin(p)*(s-u)+c,f=Math.sin(p)*(n-c)+Math.cos(p)*(s-u)+u,y=Math.sin(p)*(n+h-c)+Math.cos(p)*(s+a-u)+u):Math.PI/2<p&&p<=Math.PI?(l=Math.cos(p)*(n+h-c)-Math.sin(p)*(s+a-u)+c,d=Math.cos(p)*(n-c)-Math.sin(p)*(s-u)+c,f=Math.sin(p)*(n-c)+Math.cos(p)*(s+a-u)+u,y=Math.sin(p)*(n+h-c)+Math.cos(p)*(s-u)+u):Math.PI<p&&p<=1.5*Math.PI?(l=Math.cos(p)*(n+h-c)-Math.sin(p)*(s-u)+c,d=Math.cos(p)*(n-c)-Math.sin(p)*(s+a-u)+c,f=Math.sin(p)*(n+h-c)+Math.cos(p)*(s+a-u)+u,y=Math.sin(p)*(n-c)+Math.cos(p)*(s-u)+u):1.5*Math.PI<p&&p<=2*Math.PI&&(l=Math.cos(p)*(n-c)-Math.sin(p)*(s-u)+c,d=Math.cos(p)*(n+h-c)-Math.sin(p)*(s+a-u)+c,f=Math.sin(p)*(n+h-c)+Math.cos(p)*(s-u)+u,y=Math.sin(p)*(n-c)+Math.cos(p)*(s+a-u)+u),(!this.x||this.x>l)&&(this.x=l),(!this.y||this.y>f)&&(this.y=f),this.width<d&&(this.width=d),this.height<y&&(this.height=y)}this.width-=this.x,this.height-=this.y,this.firstWidth=this.width,this.firstHeight=this.height;for(o=0,r=t.length;o<r;o++){var v;(v=t[o])._x?(v.x+=e-this.x,v.y+=i-this.y):(v._x=v.x,v._y=v.y,v.x-=this.x,v.y-=this.y)}return this},e.prototype.releaseChild=function(t){var e=this.parent;t.x=t._x,t.y=t._y,t.width=t._width,t.height=t._height,t.rot=t._rot,t._x=1/0,t._y=1/0,t._width=1/0,t._height=1/0,t._rot=1/0,t.grouped=!1,t._leave=!1,t.parent=e},e.prototype.releaseAllChildren=function(){for(var t=this.children,e=0,i=t.length;e<i;e++){var o=t[e];this.releaseChild(o)}return this.children=[],this._remove=!0,this},e.prototype.removeChildrenByProperty=function(t){for(var e=this.getChildren(t),i=0,o=e.length;i<o;i++)e[i].remove();return this},e.prototype.removeAllChildren=function(){for(var t=this.children,e=(this.parent,0),i=t.length;e<i;e++)t[e].remove();return this},e.prototype._setAbsPos=function(t){var e=this.width/2,i=this.height/2,o=this.rot;t.Cx=this.scaleX*t.x+t._width/2,t.Cy=this.scaleY*t.y+t._height/2,t.startRot=!0;var r=Math.cos(o)*(t.Cx-e)-Math.sin(o)*(t.Cy-i)+e,n=Math.sin(o)*(t.Cx-e)+Math.cos(o)*(t.Cy-i)+i;t._x=r-t._width/2,t._y=n-t._height/2,t._x+=this.x,t._y+=this.y},e.prototype.draw=function(){var t=this.children;this.scaleX=this.width/this.firstWidth,this.scaleY=this.height/this.firstHeight;for(var e=0,i=t.length;e<i;e++){var o=t[e];o._leave||o._remove?(t.splice(e,1),this.releaseChild(o),e--,i--):(o._rot=o.rot+this.rot,o._width=this.scaleX*o.width,o._height=this.scaleY*o.height,this._setAbsPos(o))}},e}(i(3).Group);e.Layer=n},function(t,e,i){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=i(5),s=i(0),h=function(t){function e(e,i,o){var r=t.call(this,e,i,o)||this;return r.drawData=[],r.hitData=[],r}return r(e,t),e.prototype.intersect=function(t,e){for(var i=this.hitData,o=i[0].length,r=i.length,n=this._width||this.width,s=this._height||this.height,h=this._x||this.x,a=this._y||this.y,c=0;c<r;c++)for(var u=0;u<o;u++)if(1==i[c][u]&&h+u*n<t&&t<h+(u+1)*n&&a+c*s<e&&e<a+(c+1)*s)return!0;return!1},e.prototype.draw=function(){var t=s.getImageAssets(),e=this.drawData;if(e&&e[0]){var i=e[0].length,o=e.length,r=this._width||this.width,n=this._height||this.height,h=this._x||this.x,a=this._y||this.y,c=0,u=0,p=this.field,l=this.ctx;l.globalAlpha=this.alpha,l.globalCompositeOperation=this.drawMode;for(var d=p.height,f=p.width,y=void 0,v=t[this.img],g=this.spriteWidth,m=this.spriteHeight,_=v.width/g,x=v.height/m,b=this.width/g,w=this.height/m,M=h,S=a;c<o;){for(;u<i;){if((y=e[c][u])>=0&&d>a+n*c&&a+n*(c+1)>0&&f>h+r*u&&h+r*(u+1)>0){var T=y%_*g,C=~~(y/_)%x*m;l.save(),l.translate(M,S),l.scale(b,w),l.drawImage(v,T,C,g,m,0,0,g,m),l.restore()}M+=r,u++}S+=n,M=h,c++,u=0}}},e}(n.Sprite);e.Map=h},function(t,e,i){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=i(2),s=i(0),h=function(t){function e(e,i,o){var r=t.call(this,0,0)||this;return r.obj=-1,r.svgid="",r._basicConstructor="Shape",r.color=i||"original",r.strokeColor=o||"original",r.colorStops=[],"svg"!=r.getExtention(e)?r.svgid=e:r.setImage(e),r.closeMode=!0,r.strokeMode=!0,r}return r(e,t),e.prototype.setSpriteSize=function(t,e){this.spriteWidth=t,this.spriteHeight=e},e.prototype.setImage=function(t){for(var e=s.getSvgAssets(),i=0,o=e.length;i<o;i++)t==e[i].name&&(this.obj=i)},e.prototype.getImage=function(){return s.getSvgAssets()[this.obj]},e.prototype.getImageName=function(){return s.getSvgAssets()[this.obj].data},e.prototype.parsePolygon=function(t){for(var e=t.split(" "),i=[],o=0,r=e.length-1;o<r;o++){var n=e[o].split(","),s={method:"lineTo",x:Number(n[0]),y:Number(n[1])};i.push(s)}return i},e.prototype.parsePath=function(t){var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},i=[];return t.replace(/([astvzqmhlc])([^astvzqmhlc]*)/gi,(function(t,o,r){var n=o.toLowerCase();for(r=(r=r.match(/-?[.0-9]+(?:e[-+]?\d+)?/gi))?r.map(Number):[],"m"==n&&r.length>2&&(i.push([o].concat(r.splice(0,2))),n="l",o="m"==o?"l":"L");;){if(r.length==e[n]){r.unshift(o);var s={};return s="q"==r[0]?{method:"quadraticCurveBy",cpx:r[1],cpy:r[2],x:r[3],y:r[4]}:"Q"==r[0]?{method:"quadraticCurveTo",cpx:r[1],cpy:r[2],x:r[3],y:r[4]}:"l"==r[0]?{method:"lineBy",x:r[1],y:r[2]}:"L"==r[0]?{method:"lineTo",x:r[1],y:r[2]}:"m"==r[0]?{method:"moveBy",x:r[1],y:r[2]}:"M"==r[0]?{method:"moveTo",x:r[1],y:r[2]}:"c"==r[0]?{method:"bezierCurveBy",cpx1:r[1],cpy1:r[2],cpx2:r[3],cpy2:r[4],x:r[5],y:r[6]}:"C"==r[0]?{method:"bezierCurveTo",cpx1:r[1],cpy1:r[2],cpx2:r[3],cpy2:r[4],x:r[5],y:r[6]}:"h"==r[0]?{method:"horizontalBy",x:r[1]}:"H"==r[0]?{method:"horizontalTo",x:r[1]}:"v"==r[0]?{method:"verticalBy",y:r[1]}:"V"==r[0]?{method:"verticalTo",y:r[1]}:"s"==r[0]?{method:"bezierCurveShortBy",cpx2:r[1],cpy2:r[2],x:r[3],y:r[4]}:"S"==r[0]?{method:"bezierCurveShortTo",cpx2:r[1],cpy2:r[2],x:r[3],y:r[4]}:"t"==r[0]?{method:"quadraticCurveShortBy",x:r[1],y:r[2]}:"T"==r[0]?{method:"quadraticCurveShortTo",x:r[1],y:r[2]}:{},i.push(s)}i.push([o].concat(r.splice(0,e[n])))}})),i},e.prototype.isLoaded=function(){var t=this.getImage();return!t||!(!t.dataset.loaded||!this.ctx)},e.prototype.setLinearGradient=function(t,e,i,o){this.gradientStyle={x1:t,y1:e,x2:i,y2:o},this.gradientType=1},e.prototype.setRadialGradient=function(t,e,i,o,r,n){o||(o=t,r=e,n=n),this.gradientStyle={x1:t,y1:e,r1:i,x2:o,y2:r,r2:n},this.gradientType=2},e.prototype._addColorStops=function(t){for(var e=this.color,i=0,o=t.length;i<o;i++){var r=t[i],n=r.color;"string"!=typeof e&&e.addColorStop(parseInt(r.offset),n)}this.color=e},e.prototype.setColorStops=function(t){this.colorStops=t;var e=this.gradientStyle;1==this.gradientType?this.color=this.ctx.createLinearGradient(e.x1,e.y1,e.x2,e.y2):2==this.gradientType&&(this.color=this.ctx.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2)),this._addColorStops(t)},e.prototype.addColorStops=function(t){for(var e=0,i=t.length;e<i;e++)this.colorStops.push(t[e]);this._addColorStops(t)},e.prototype.removeColorStopAt=function(t){this.colorStops.splice(t,1),this.setColorStops(this.colorStops)},e.prototype.getGradientType=function(){var t=this.gradientType;return 1==t?"linear":2==t?"radial":"single"},e.prototype._onLoad=function(){var t,e,i=s.getSvgAssets();if(-1!=this.obj){var o=(e=i[this.obj].getSVGDocument()).getElementsByTagName("path")[0]||e.getElementsByTagName("circle")[0]||e.getElementsByTagName("rect")[0]||e.getElementsByTagName("polygon")[0];t=e.getElementsByTagName("svg")[0]}else o=(e=t=document.getElementById(this.svgid)).getElementsByTagName("path")[0]||e.getElementsByTagName("circle")[0]||e.getElementsByTagName("rect")[0]||e.getElementsByTagName("polygon")[0];var r=t.getElementsByTagName("linearGradient")[0]||e.getElementsByTagName("radialGradient")[0];if(r){for(var n=r.getElementsByTagName("stop"),h=[],a=0,c=n.length;a<c;a++){var u=n[a],p={};p.offset=u.getAttribute("offset");var l=u.style.stopColor,d=u.style.stopOpacity;d&&(l=(l=l.replace("rgb","rgba")).replace(")",","+d+")")),p.color=l,h.push(p)}if("linearGradient"==r.tagName){var f=Number(r.getAttribute("x1")),y=Number(r.getAttribute("x2")),v=Number(r.getAttribute("y1")),g=Number(r.getAttribute("y2"));this.setLinearGradient(f,v,y,g)}else if("radialGradient"==r.tagName){var m=Number(r.getAttribute("cx")),_=Number(r.getAttribute("cy")),x=Number(r.getAttribute("r"));this.setRadialGradient(m,_,0,m,_,x)}this.setColorStops(h)}if("original"==this.color&&(this.color=o.getAttribute("fill")),"original"==this.strokeColor&&(this.strokeColor,o.getAttribute("stroke")),"path"==o.tagName){var b=o.getAttribute("d");this.path=this.parsePath(b)}else if("circle"==o.tagName){var w=o.getAttribute("r");(S=[]).push({method:"circle",r:parseInt(w)}),this.path=S}else if("polygon"==o.tagName){var M=o.getAttribute("points");this.path=this.parsePolygon(M)}else if("rect"==o.tagName){var S,T=o.getAttribute("width"),C=o.getAttribute("height");(S=[]).push({method:"rect",width:T,height:C}),this.path=S}if(null==this.spriteWidth&&(this.spriteWidth=parseInt(t.getAttribute("width")),this.spriteHeight=parseInt(t.getAttribute("height")),!this.spriteWidth)){var I=t.getAttribute("viewBox");if(I){var P=I.split(" ");this.spriteWidth=parseInt(P[2]),this.spriteHeight=parseInt(P[3])}}this.width||(this.width=this.spriteWidth),this.height||(this.height=this.spriteHeight),this.prepared=!0},e.prototype.draw=function(){this.path||this._onLoad();var t=this.path,e=this.ctx,i=0,o=0,r=0,n=0,s=0,h=0,a=this.width,c=this.height,u=a/this.spriteWidth,p=c/this.spriteHeight,l=a/2,d=c/2,f=this._x||this.x,y=this._y||this.y,v=this._rot||this.rot;e.globalAlpha=this.alpha,e.globalCompositeOperation=this.drawMode,e.save(),e.translate(f+l,y+d),e.rotate(v),e.translate(-l,-d),e.scale(u,p),e.beginPath();for(var g=0,m=t.length;g<m;g++){var _=this.path[g],x=_.method;if("moveTo"==x||"horizontalTo"==x||"verticalTo"==x||"quadraticCurveTo"==x||"bezierCurveTo"==x||"lineTo"==x||"bezierCurveShortTo"==x||"quadraticCurveShortTo"==x?(r=0,n=0,(_.x||0==_.x)&&(i=_.x),(_.y||0==_.y)&&(o=_.y)):(r=i,n=o,_.x&&(i+=_.x),_.y&&(o+=_.y)),"circle"==x){var b=_.r;e.arc(i+b,o+b,b,0,2*Math.PI,!1)}else"rect"==x?e.fillRect(i,o,_.width,_.height):"moveTo"==x||"moveBy"==x?e.moveTo(i,o):"lineTo"==x||"lineBy"==x?e.lineTo(i,o):"quadraticCurveBy"==x||"quadraticCurveTo"==x?(e.quadraticCurveTo(r+_.cpx,n+_.cpy,i,o),s=2*i-(r+_.cpx),h=2*o-(n+_.cpy)):"bezierCurveTo"==x||"bezierCurveBy"==x?(e.bezierCurveTo(r+_.cpx1,n+_.cpy1,r+_.cpx2,n+_.cpy2,i,o),s=2*i-(r+_.cpx2),h=2*o-(n+_.cpy2)):"horizontalTo"==x||"horizontalBy"==x?e.lineTo(i,o):"verticalTo"==x||"verticalBy"==x?e.lineTo(i,o):"bezierCurveShortBy"==x||"bezierCurveShortTo"==x?(e.bezierCurveTo(s,h,r+_.cpx2,n+_.cpy2,i,o),s=2*i-(r+_.cpx2),h=2*o-(n+_.cpy2)):"quadraticCurveShortBy"!=x&&"quadraticCurveShortTo"!=x||(e.quadraticCurveTo(s,h,i,o),s=2*i-s,h=2*o-h)}this.closeMode&&e.closePath(),e.fillStyle=this.color,e.fill(),e.strokeStyle=this.strokeColor,this.strokeMode&&e.stroke(),e.restore()},e.prototype.getNodeByName=function(t){for(var e=this.path,i=0,o=e.length;i<o;i++){var r=e[i];if(t==r.name)return r}return-1},e}(n.Thing);e.Shape=h;var a=function(t){function e(e,i,o){var r=t.call(this,i,o)||this;return r._basicConstructor="Shape.Box",r.color=e,r}return r(e,t),e.prototype.draw=function(){var t=this.ctx;t.globalAlpha=this.alpha,t.globalCompositeOperation=this.drawMode,t.beginPath(),t.fillStyle=this.color;var e=this._x||this.x,i=this._y||this.y,o=this._rot||this.rot,r=this._width||this.width,n=this._height||this.height,s=e+this.width/2,h=i+this.height/2;t.save(),t.translate(s,h),t.rotate(o),t.translate(-s,-h);e=this._x||this.x,i=this._y||this.y;t.fillRect(e,i,r,n),t.restore(),t.globalAlpha=1},e}(n.Thing);e.Box=a;var c=function(t){function e(e,i){var o=t.call(this,2*i,2*i)||this;return o._basicConstructor="Shape.Circle",o.color=e,o.collisionShape="circle",o}return r(e,t),e.prototype.draw=function(){var t=this.ctx;t.globalAlpha=this.alpha,t.globalCompositeOperation=this.drawMode,t.beginPath(),t.fillStyle=this.color;var e=(this._width||this.width)/2,i=this._x||this.x,o=this._y||this.y;t.arc(i+e,o+e,e,0,2*Math.PI,!1),t.fill(),t.globalAlpha=1},e}(n.Thing);e.Circle=c},function(t,e,i){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(e,i,o,r){var n=t.call(this)||this;return n._basicConstructor="Text",n.x=0,n.y=0,n.scaleX=1,n.scaleY=1,n.alpha=1,n.spaceWidth=7,n.font=r?"'"+r+"'":"'Meiryo'",n.size=o?o+"px":"10px",n.string=e||"",n.color=i||"white",n}return r(e,t),e.prototype.setSize=function(t){this.size=t+"px"},e.prototype.setFont=function(t){this.font="'"+t+"'"},e.prototype.intersect=function(t,e){var i=this._x||this.x,o=this._y||this.y,r=parseInt(this.size)*this.scaleX*this.string.length,n=parseInt(this.size)*this.scaleY,s=t-(i+r/2),h=e-(o+n/2),a=this._rot||this.rot,c=Math.sin(-a),u=Math.cos(-a),p=Math.abs(s*u-h*c),l=Math.abs(s*c+h*u);return p<r/2&&l<n/2},e.prototype.scale=function(t,e){this.scaleX*=t,this.scaleY*=e},e.prototype._scaleBy=function(t){0==t.time&&(t.diffWidth=t.scaleX-this.scaleX,t.diffHeight=t.scaleY-this.scaleY),this.scaleX=t.scaleX-t.diffWidth*(1-t.time/t.frame),this.scaleY=t.scaleY-t.diffHeight*(1-t.time/t.frame)},e.prototype.draw=function(){var t=this._x||this.x,e=this._y||this.y,i=this._rot||this.rot,o=this.scaleX,r=this.scaleY,n=this.ctx,s=this.string.split("<br>"),h=s.length;n.globalAlpha=this.alpha,n.globalCompositeOperation=this.drawMode,n.font=this.size+" "+this.font;var a=1.5*n.measureText("a").width+this.spaceWidth;n.fillStyle=this.color,n.save();var c=parseInt(this.size)*this.scaleX*this.string.length/2,u=parseInt(this.size)*this.scaleY/2;n.translate(t+c,e+u),n.rotate(i),n.translate(-c,-u),n.scale(o,r);for(var p=0;p<h;p++)n.fillText(s[p],0,a),a*=2;n.restore(),n.globalAlpha=1},e}(i(1).Util);e.Text=n}]).default}));